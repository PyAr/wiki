<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Acceso a Bases de Datos desde Python: Interfaz DB-API | Python Argentina Wiki</title>
<link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../assets/css/bootblog.css" rel="stylesheet" type="text/css">
<link href="../assets/css/custom.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="https://wiki.python.org.ar/dbapi/">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><meta name="author" content="Python Argentina">
<meta property="og:site_name" content="Python Argentina Wiki">
<meta property="og:title" content="Acceso a Bases de Datos desde Python: Interfaz DB-API">
<meta property="og:url" content="https://wiki.python.org.ar/dbapi/">
<meta property="og:description" content="Contenido

¿Cómo me conecto a una base de datos con MySQL?
¿Cómo me conecto a una base de datos con PostgreSQL?
Parámetros


En python, el acceso a bases de datos esta estandarizado por la especificac">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-06-23T10:00:50-03:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light"><a class="navbar-brand" href="#">Navbar</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar"><span class="inicio"></span>Inicio</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../pyar/"><span class="quienes_somos"></span>Nosotros</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../foro_y_redes/"><span class="navbar_lista_de_correo"></span>Foro</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="../"><span class="wiki"></span>Wiki</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/noticias/"><span class="news"></span>Noticias</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/irc/"><span class="irc"></span>IRC</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/eventos/"><span class="eventos"></span>Eventos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://planeta.python.org.ar/"><span class="pyar"></span>Planeta</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/trabajo/"><span class="jobs"></span>Trabajos</a>
                </li>
            </ul>
</div>
    </nav>
</div>

<!-- Header and menu bar -->
<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
<div class="col-lg-12">
    <div class="page-header">
        <div class="pull-right">
            <a href="https://github.com/PyAr/wiki/blob/master/pages/dbapi.rst" id="sourcelink" class="nav-link">Editar</a>
        </div>
        <h2>Acceso A Bases De Datos Desde Python: Interfaz Db-Api</h2>
    </div>
    <div class="e-content entry-content" itemprop="articleBody text">
    <nav class="contents" id="contenido" role="doc-toc"><p class="topic-title"><a class="reference internal" href="#top">Contenido</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#como-me-conecto-a-una-base-de-datos-con-mysql" id="toc-entry-1">¿Cómo me conecto a una base de datos con MySQL?</a></p></li>
<li><p><a class="reference internal" href="#como-me-conecto-a-una-base-de-datos-con-postgresql" id="toc-entry-2">¿Cómo me conecto a una base de datos con PostgreSQL?</a></p></li>
<li><p><a class="reference internal" href="#parametros" id="toc-entry-3">Parámetros</a></p></li>
</ul></nav><p>En python, el acceso a bases de datos esta estandarizado por la especificación Database API (DB-API), actualmente en la versión 2.0 (<a class="reference external" href="http://www.python.org/dev/peps/pep-0249/">PEP 249: Python Database API Specification v2.0</a>)</p>
<p>Gracias a esto, se puede acceder a cualquier base de datos utlizando la misma interfaz (ya sea un motor remoto, local, ODBC, etc.). Se puede comparar con DAO, ADO, ADO.NET en el mundo Microsoft, o a JDBC en el mundo Java.</p>
<p>O sea, el mismo codigo se podría llegar a usar para cualquier base de datos, tomando siempre los recaudos necesarios (lenguaje SQL estándard, estilo de parametros soportado, etc.)</p>
<p>Por ello, el manejo de bases de datos en python siempre sigue estos pasos:</p>
<ol class="arabic simple">
<li><p>Importar el conector</p></li>
<li><p>Conectarse a la base de datos (función connect del módulo conector)</p></li>
<li><p>Abrir un Cursor (método cursor de la conexión)</p></li>
<li><p>Ejecutar una consulta (método execute del cursor)</p></li>
<li><p>Obtener los datos (método fetch o iterar sobre el cursor)</p></li>
<li><p>Cerrar el cursor (método close del cursor)</p></li>
</ol>
<hr class="docutils">
<section id="como-me-conecto-a-una-base-de-datos-con-mysql"><h2><a class="toc-backref" href="#toc-entry-1" role="doc-backlink">¿Cómo me conecto a una base de datos con MySQL?</a></h2>
<p>Este es un ejemplo basico de como hacerlo con MySQL:</p>
<div class="code"><pre class="code python"><a id="rest_code_cbdcd92f13d042b9b1bdee7add3917cf-1" name="rest_code_cbdcd92f13d042b9b1bdee7add3917cf-1" href="#rest_code_cbdcd92f13d042b9b1bdee7add3917cf-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">MySQLdb</span>
<a id="rest_code_cbdcd92f13d042b9b1bdee7add3917cf-2" name="rest_code_cbdcd92f13d042b9b1bdee7add3917cf-2" href="#rest_code_cbdcd92f13d042b9b1bdee7add3917cf-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">"localhost"</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">"root"</span><span class="p">,</span>
<a id="rest_code_cbdcd92f13d042b9b1bdee7add3917cf-3" name="rest_code_cbdcd92f13d042b9b1bdee7add3917cf-3" href="#rest_code_cbdcd92f13d042b9b1bdee7add3917cf-3"></a><span class="o">...</span> <span class="n">passwd</span><span class="o">=</span><span class="s2">"mypassword"</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s2">"PythonU"</span><span class="p">)</span>
</pre></div>
<p>Una vez establecida la conexion, hay que crear un "cursor". Un cursor es una estructura de control que se usa para recorrer (y eventualmente procesar) los records de un result set.</p>
<p>El metodo para crear el cursor se llama, originalmente, cursor():</p>
<div class="code"><pre class="code python"><a id="rest_code_06e13b94b4d747f7b0e861c294d5af59-1" name="rest_code_06e13b94b4d747f7b0e861c294d5af59-1" href="#rest_code_06e13b94b4d747f7b0e861c294d5af59-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
<p>Ya tenemos la conexion establecida y el cursor creado, es hora de ejecutar algunos comandos SQL:</p>
<div class="code"><pre class="code python"><a id="rest_code_c2fca514522146b8a80b646a6b7fb9ca-1" name="rest_code_c2fca514522146b8a80b646a6b7fb9ca-1" href="#rest_code_c2fca514522146b8a80b646a6b7fb9ca-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM Students"</span><span class="p">)</span>
<a id="rest_code_c2fca514522146b8a80b646a6b7fb9ca-2" name="rest_code_c2fca514522146b8a80b646a6b7fb9ca-2" href="#rest_code_c2fca514522146b8a80b646a6b7fb9ca-2"></a><span class="mi">5</span><span class="n">L</span>
</pre></div>
<p>El metodo execute se usa para ejecutar comandos SQL. Note que no hace falta agregar el ';' (punto y coma) al final del comando. Ahora es cuestion de recorrer el objeto cursor.</p>
<p>Para obtener un solo elemento, usamos fetchone():</p>
<div class="code"><pre class="code python"><a id="rest_code_35791c69bad5403ba587c8884a7f5c9a-1" name="rest_code_35791c69bad5403ba587c8884a7f5c9a-1" href="#rest_code_35791c69bad5403ba587c8884a7f5c9a-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="rest_code_35791c69bad5403ba587c8884a7f5c9a-2" name="rest_code_35791c69bad5403ba587c8884a7f5c9a-2" href="#rest_code_35791c69bad5403ba587c8884a7f5c9a-2"></a><span class="p">(</span><span class="mi">1</span><span class="n">L</span><span class="p">,</span> <span class="s1">'Joe'</span><span class="p">,</span> <span class="s1">'Campbell'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="s1">'N'</span><span class="p">)</span>
<a id="rest_code_35791c69bad5403ba587c8884a7f5c9a-3" name="rest_code_35791c69bad5403ba587c8884a7f5c9a-3" href="#rest_code_35791c69bad5403ba587c8884a7f5c9a-3"></a>
<a id="rest_code_35791c69bad5403ba587c8884a7f5c9a-4" name="rest_code_35791c69bad5403ba587c8884a7f5c9a-4" href="#rest_code_35791c69bad5403ba587c8884a7f5c9a-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="rest_code_35791c69bad5403ba587c8884a7f5c9a-5" name="rest_code_35791c69bad5403ba587c8884a7f5c9a-5" href="#rest_code_35791c69bad5403ba587c8884a7f5c9a-5"></a><span class="p">((</span><span class="mi">1</span><span class="n">L</span><span class="p">,</span> <span class="s1">'Joe'</span><span class="p">,</span> <span class="s1">'Campbell'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="s1">'N'</span><span class="p">),</span>
<a id="rest_code_35791c69bad5403ba587c8884a7f5c9a-6" name="rest_code_35791c69bad5403ba587c8884a7f5c9a-6" href="#rest_code_35791c69bad5403ba587c8884a7f5c9a-6"></a><span class="p">(</span><span class="mi">2</span><span class="n">L</span><span class="p">,</span> <span class="s1">'Joe'</span><span class="p">,</span> <span class="s1">'Doe'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2004</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="s1">'N'</span><span class="p">),</span>
<a id="rest_code_35791c69bad5403ba587c8884a7f5c9a-7" name="rest_code_35791c69bad5403ba587c8884a7f5c9a-7" href="#rest_code_35791c69bad5403ba587c8884a7f5c9a-7"></a><span class="p">(</span><span class="mi">3</span><span class="n">L</span><span class="p">,</span> <span class="s1">'Rick'</span><span class="p">,</span> <span class="s1">'Hunter'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="s1">'N'</span><span class="p">),</span>
<a id="rest_code_35791c69bad5403ba587c8884a7f5c9a-8" name="rest_code_35791c69bad5403ba587c8884a7f5c9a-8" href="#rest_code_35791c69bad5403ba587c8884a7f5c9a-8"></a><span class="p">(</span><span class="mi">4</span><span class="n">L</span><span class="p">,</span> <span class="s1">'Laura'</span><span class="p">,</span> <span class="s1">'Ingalls'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="s1">'Y'</span><span class="p">),</span>
<a id="rest_code_35791c69bad5403ba587c8884a7f5c9a-9" name="rest_code_35791c69bad5403ba587c8884a7f5c9a-9" href="#rest_code_35791c69bad5403ba587c8884a7f5c9a-9"></a><span class="p">(</span><span class="mi">5</span><span class="n">L</span><span class="p">,</span> <span class="s1">'Virginia'</span><span class="p">,</span> <span class="s1">'Gonzalez'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'N'</span><span class="p">))</span>
</pre></div>
<p>Cual metodo usar dependera de la cantidad de datos que tengamos, la memoria disponible en la PC y sobre todo, de como querramos hacerlo. Si estamos trabajando con datasets limitados, no habra problema con el uso de fetchall(), pero si la base de datos es lo suficientemente grande como para entrar en memoria, se podria implementar una estrategia como la que se encuentra aca:</p>
<div class="code"><pre class="code python"><a id="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-1" name="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-1" href="#rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-1"></a><span class="kn">import</span> <span class="nn">MySQLdb</span>
<a id="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-2" name="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-2" href="#rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-2"></a><span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">"localhost"</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">"root"</span><span class="p">,</span><span class="n">passwd</span><span class="o">=</span><span class="s2">"secret"</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s2">"PythonU"</span><span class="p">)</span>
<a id="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-3" name="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-3" href="#rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-3"></a><span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-4" name="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-4" href="#rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-4"></a><span class="n">recs</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM Students"</span><span class="p">)</span>
<a id="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-5" name="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-5" href="#rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-5"></a><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">recs</span><span class="p">):</span>
<a id="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-6" name="rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-6" href="#rest_code_4c3b0bc79cbd439f8074f714e1df8ea0-6"></a>   <span class="nb">print</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</pre></div>
<p>O directamente:</p>
<div class="code"><pre class="code python"><a id="rest_code_f16f4c8f6fd142c7949401d8020c2a12-1" name="rest_code_f16f4c8f6fd142c7949401d8020c2a12-1" href="#rest_code_f16f4c8f6fd142c7949401d8020c2a12-1"></a><span class="kn">import</span> <span class="nn">MySQLdb</span>
<a id="rest_code_f16f4c8f6fd142c7949401d8020c2a12-2" name="rest_code_f16f4c8f6fd142c7949401d8020c2a12-2" href="#rest_code_f16f4c8f6fd142c7949401d8020c2a12-2"></a><span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">"localhost"</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">"root"</span><span class="p">,</span><span class="n">passwd</span><span class="o">=</span><span class="s2">"secret"</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s2">"PythonU"</span><span class="p">)</span>
<a id="rest_code_f16f4c8f6fd142c7949401d8020c2a12-3" name="rest_code_f16f4c8f6fd142c7949401d8020c2a12-3" href="#rest_code_f16f4c8f6fd142c7949401d8020c2a12-3"></a><span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="rest_code_f16f4c8f6fd142c7949401d8020c2a12-4" name="rest_code_f16f4c8f6fd142c7949401d8020c2a12-4" href="#rest_code_f16f4c8f6fd142c7949401d8020c2a12-4"></a><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM Students"</span><span class="p">)</span>
<a id="rest_code_f16f4c8f6fd142c7949401d8020c2a12-5" name="rest_code_f16f4c8f6fd142c7949401d8020c2a12-5" href="#rest_code_f16f4c8f6fd142c7949401d8020c2a12-5"></a><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
<a id="rest_code_f16f4c8f6fd142c7949401d8020c2a12-6" name="rest_code_f16f4c8f6fd142c7949401d8020c2a12-6" href="#rest_code_f16f4c8f6fd142c7949401d8020c2a12-6"></a>   <span class="nb">print</span> <span class="n">row</span>
</pre></div>
<p>(Sebastian Bassi)</p>
</section><hr class="docutils">
<section id="como-me-conecto-a-una-base-de-datos-con-postgresql"><h2><a class="toc-backref" href="#toc-entry-2" role="doc-backlink">¿Cómo me conecto a una base de datos con PostgreSQL?</a></h2>
<p>Otro ejemplo basico de como hacerlo con PostgreSQL (similar al de MySQL).  Se usó el esquema: <code class="docutils literal">CREATE TABLE estudiante ( nombre varchar,  apellido varchar,  fecha date,  booleano bool,  legajo serial PRIMARY KEY);</code> Antes que nada se debe instalar el conector (<a class="reference external" href="http://www.initd.org/tracker/psycopg/wiki/PsycopgTwo">para unix y windows</a>).</p>
<p>Primero importar el conector y crear la conexión a la base de datos:</p>
<div class="code"><pre class="code python"><a id="rest_code_c4aded090dbe4b55b5904ee7b38f72ba-1" name="rest_code_c4aded090dbe4b55b5904ee7b38f72ba-1" href="#rest_code_c4aded090dbe4b55b5904ee7b38f72ba-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">psycopg2</span><span class="o">,</span> <span class="nn">psycopg2.extras</span>
<a id="rest_code_c4aded090dbe4b55b5904ee7b38f72ba-2" name="rest_code_c4aded090dbe4b55b5904ee7b38f72ba-2" href="#rest_code_c4aded090dbe4b55b5904ee7b38f72ba-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s1">'test'</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s1">'postgres'</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s1">'pass'</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">'localhost'</span><span class="p">)</span>
</pre></div>
<p>Luego crear un cursor para obtener los datos y ejecutar consulta:</p>
<div class="code"><pre class="code python"><a id="rest_code_96fc2f67d36b42edabcbf6010841fefa-1" name="rest_code_96fc2f67d36b42edabcbf6010841fefa-1" href="#rest_code_96fc2f67d36b42edabcbf6010841fefa-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="rest_code_96fc2f67d36b42edabcbf6010841fefa-2" name="rest_code_96fc2f67d36b42edabcbf6010841fefa-2" href="#rest_code_96fc2f67d36b42edabcbf6010841fefa-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM estudiante"</span><span class="p">)</span>
<a id="rest_code_96fc2f67d36b42edabcbf6010841fefa-3" name="rest_code_96fc2f67d36b42edabcbf6010841fefa-3" href="#rest_code_96fc2f67d36b42edabcbf6010841fefa-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">rows</span><span class="o">=</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="rest_code_96fc2f67d36b42edabcbf6010841fefa-4" name="rest_code_96fc2f67d36b42edabcbf6010841fefa-4" href="#rest_code_96fc2f67d36b42edabcbf6010841fefa-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span> <span class="n">rows</span>
<a id="rest_code_96fc2f67d36b42edabcbf6010841fefa-5" name="rest_code_96fc2f67d36b42edabcbf6010841fefa-5" href="#rest_code_96fc2f67d36b42edabcbf6010841fefa-5"></a>
<a id="rest_code_96fc2f67d36b42edabcbf6010841fefa-6" name="rest_code_96fc2f67d36b42edabcbf6010841fefa-6" href="#rest_code_96fc2f67d36b42edabcbf6010841fefa-6"></a><span class="p">[[</span><span class="s1">'Joe'</span><span class="p">,</span> <span class="s1">'Capbell'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">'Joe'</span><span class="p">,</span> <span class="s1">'Doe'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2004</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s1">'Rick'</span><span class="p">,</span> <span class="s1">'Hunter'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="s1">'Laura'</span><span class="p">,</span> <span class="s1">'Ingalls'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="s1">'Virginia'</span><span class="p">,</span> <span class="s1">'Gonzalez'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
</pre></div>
<p>Algo más pitónico es crear el cursor simil diccionario (en vez de una lista de valores):</p>
<div class="code"><pre class="code python"><a id="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-1" name="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-1" href="#rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor_factory</span><span class="o">=</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>
<a id="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-2" name="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-2" href="#rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM estudiante"</span><span class="p">)</span>
<a id="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-3" name="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-3" href="#rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span> <span class="c1"># itero sober cada fila</span>
<a id="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-4" name="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-4" href="#rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-4"></a><span class="o">&gt;&gt;&gt;</span>    <span class="c1"># row es un diccionario, con las claves = nombres de campos</span>
<a id="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-5" name="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-5" href="#rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-5"></a><span class="o">&gt;&gt;&gt;</span>    <span class="nb">print</span> <span class="s2">"Nombre y Apellido: </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> "</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">'nombre'</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">'apellido'</span><span class="p">])</span>
<a id="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-6" name="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-6" href="#rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-6"></a>
<a id="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-7" name="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-7" href="#rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-7"></a><span class="n">Nombre</span> <span class="n">y</span> <span class="n">Apellido</span><span class="p">:</span> <span class="n">Joe</span><span class="p">,</span> <span class="n">Capbell</span>
<a id="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-8" name="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-8" href="#rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-8"></a><span class="n">Nombre</span> <span class="n">y</span> <span class="n">Apellido</span><span class="p">:</span> <span class="n">Joe</span><span class="p">,</span> <span class="n">Doe</span>
<a id="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-9" name="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-9" href="#rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-9"></a><span class="n">Nombre</span> <span class="n">y</span> <span class="n">Apellido</span><span class="p">:</span> <span class="n">Rick</span><span class="p">,</span> <span class="n">Hunter</span>
<a id="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-10" name="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-10" href="#rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-10"></a><span class="n">Nombre</span> <span class="n">y</span> <span class="n">Apellido</span><span class="p">:</span> <span class="n">Laura</span><span class="p">,</span> <span class="n">Ingalls</span>
<a id="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-11" name="rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-11" href="#rest_code_b0b059ba9a1e4e5ba90f7c1da979e30d-11"></a><span class="n">Nombre</span> <span class="n">y</span> <span class="n">Apellido</span><span class="p">:</span> <span class="n">Virginia</span><span class="p">,</span> <span class="n">Gonzalez</span>
</pre></div>
<p><strong>Nota:</strong> esto es propio del conector psycopg2. Igualmente otros conectores tambien lo soportan o se puede imitar (leyendo el atributo description del cursor que tiene la información de los campos):</p>
<div class="code"><pre class="code python"><a id="rest_code_36a455d1cfb6408ea489eb51db640aae-1" name="rest_code_36a455d1cfb6408ea489eb51db640aae-1" href="#rest_code_36a455d1cfb6408ea489eb51db640aae-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span> <span class="n">cur</span><span class="o">.</span><span class="n">description</span>
<a id="rest_code_36a455d1cfb6408ea489eb51db640aae-2" name="rest_code_36a455d1cfb6408ea489eb51db640aae-2" href="#rest_code_36a455d1cfb6408ea489eb51db640aae-2"></a><span class="p">((</span><span class="s1">'nombre'</span><span class="p">,</span> <span class="mi">1043</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s1">'apellido'</span><span class="p">,</span> <span class="mi">1043</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s1">'fecha'</span><span class="p">,</span> <span class="mi">1082</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s1">'booleano'</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s1">'legajo'</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</pre></div>
</section><hr class="docutils">
<section id="parametros"><h2><a class="toc-backref" href="#toc-entry-3" role="doc-backlink">Parámetros</a></h2>
<p><strong>Pregunta:</strong> Hola chicos. Estoy con un inconveniente que no puedo solventar. Tengo una funcion de python que genera unos querystrings para postgres.</p>
<p>Mi problema empieza cuando, por ejemplo hay uno de esos apellidos que tienen ', Ej: D'agostino</p>
<p>como resultado me queda el string (ejemplo)</p>
<div class="code"><pre class="code python"><a id="rest_code_53098b6fe1014158a1cec90c67f5b5d7-1" name="rest_code_53098b6fe1014158a1cec90c67f5b5d7-1" href="#rest_code_53098b6fe1014158a1cec90c67f5b5d7-1"></a><span class="s1">'insert into personas (apellido) values ("D'</span><span class="n">agostino</span><span class="s2">")'</span>
</pre></div>
<p><strong>Respuesta:</strong></p>
<p>Lo que tendrías que hacer es que postgres te escapee automaticamente los valores, usando los parámetros de db-api (segúndo argumento del metodo execute del cursor):</p>
<div class="code"><pre class="code python"><a id="rest_code_42504b592ce44b7ab8720048d5f2a439-1" name="rest_code_42504b592ce44b7ab8720048d5f2a439-1" href="#rest_code_42504b592ce44b7ab8720048d5f2a439-1"></a><span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="rest_code_42504b592ce44b7ab8720048d5f2a439-2" name="rest_code_42504b592ce44b7ab8720048d5f2a439-2" href="#rest_code_42504b592ce44b7ab8720048d5f2a439-2"></a><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"insert into personas (apellido) values (</span><span class="si">%s</span><span class="s2">)"</span> <span class="p">,</span> <span class="p">[</span><span class="s2">"D'agostino"</span><span class="p">])</span>
</pre></div>
<p>Así, automáticamente postgres sabe, según el tipo de datos del parámetro, en este caso un string = "D'agostino", como escapear y formatear el sql para que no de error.</p>
<p>Además, esto es mas seguro frente a ataques por "inyección de sql", porque el formateo es automático, en vez de usar directamente el operador % sobre el query y pasarselo cocinado a la base.</p>
<p>Para hacerlo más robusto, podrías usar diccionario con los parametros (es más seguro en el caso que tengas varios parámetros, para evitar errores):</p>
<div class="code"><pre class="code python"><a id="rest_code_a65a66cb937f4ad0af5990c84ad5a2b2-1" name="rest_code_a65a66cb937f4ad0af5990c84ad5a2b2-1" href="#rest_code_a65a66cb937f4ad0af5990c84ad5a2b2-1"></a><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"insert into personas (apellido) values (</span><span class="si">%(apellido)s</span><span class="s2">)"</span> <span class="p">,</span> <span class="p">{</span><span class="s2">"apellido"</span><span class="p">:</span><span class="s2">"D'agostino"</span><span class="p">})</span>
</pre></div>
<p>Igualmente, esto dependerá de las capacidades de cada conector (consultar variable paramstyle del módulo conector), pudiendo utilizarse los siguientes estilos de parametros:</p>
<ul class="simple">
<li><p>'qmark': Signo de interrogación, ej. '...WHERE name=?'</p></li>
<li><p>'numeric': Numerico, posicional, ej. '...WHERE name=:1'</p></li>
<li><p>'named': por Nombre, ej. '...WHERE name=:name'</p></li>
<li><p>'format': Formato ANSI C, ej. '...WHERE name=%s'</p></li>
<li><p>'pyformat': Formato Python, ej. '...WHERE name=%(name)s'</p></li>
</ul>
<!-- ############################################################################ --></section>
</div>    
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2024         <a href="mailto:admin@python.org.ar">Python Argentina</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

            <script src="../assets/js/jquery.min.js"></script><script src="../assets/js/popper.min.js"></script><script src="../assets/js/bootstrap.min.js"></script><script src="../assets/js/baguetteBox.min.js"></script><script src="../assets/js/pyar.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
