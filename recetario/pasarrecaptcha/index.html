<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>pasarrecaptcha.rst | Python Argentina Wiki</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/bootblog.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/custom.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://wiki.python.org.ar/recetario/pasarrecaptcha/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Python Argentina">
<meta property="og:site_name" content="Python Argentina Wiki">
<meta property="og:title" content="pasarrecaptcha.rst">
<meta property="og:url" content="https://wiki.python.org.ar/recetario/pasarrecaptcha/">
<meta property="og:description" content="(Por Carlos Bustillo)
# Superar la prueba &quot;I'm not a robot&quot; de reCAPTCHA con ayuda pyautogui.

En este caso vamos a probarlo este código con esta demo api: https://www.google.com/recaptcha/api2/demo .">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-06-23T10:00:50-03:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light"><a class="navbar-brand" href="#">Navbar</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar"><span class="inicio"></span>Inicio</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../pyar/"><span class="quienes_somos"></span>Nosotros</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../foro_y_redes/"><span class="navbar_lista_de_correo"></span>Foro</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="../../"><span class="wiki"></span>Wiki</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/noticias/"><span class="news"></span>Noticias</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/irc/"><span class="irc"></span>IRC</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/eventos/"><span class="eventos"></span>Eventos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://planeta.python.org.ar/"><span class="pyar"></span>Planeta</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/trabajo/"><span class="jobs"></span>Trabajos</a>
                </li>
            </ul>
</div>
    </nav>
</div>

<!-- Header and menu bar -->
<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
<div class="col-lg-12">
    <div class="page-header">
        <div class="pull-right">
            <a href="https://github.com/PyAr/wiki/blob/master/pages/recetario/pasarrecaptcha.rst" id="sourcelink" class="nav-link">Editar</a>
        </div>
        <h2>Pasarrecaptcha.rst</h2>
    </div>
    <div class="e-content entry-content" itemprop="articleBody text">
    <p><strong>(Por Carlos Bustillo)</strong></p>
<p># Superar la prueba "I'm not a robot" de reCAPTCHA con ayuda pyautogui.</p>
<img alt="/images/Recetario/pasarrecaptcha/captcha.jpg" src="../../images/Recetario/pasarrecaptcha/captcha.jpg"><p>En este caso vamos a probarlo este código con esta demo api: <a class="reference external" href="https://www.google.com/recaptcha/api2/demo">https://www.google.com/recaptcha/api2/demo</a> .</p>
<p>## Librerías utilizadas:</p>
<ul class="simple">
<li><p>pyautogui</p></li>
<li><p>cv2</p></li>
<li><p>time</p></li>
</ul>
<p>## Implementación</p>
<p>Realizamos un polling (hace referencia a una operación de consulta constante) para cuando aparezca la imagen de la api demo. Por eso está tomando screenshot de la pantalla cada cierto período de tiempo hasta encontrarlo. Sino lo encuentra después de un cierto valor máximo de tiempo, se detiene la ejecución. Y una vez que encuentra la ventana de la api, hará un rectángulo negro alrededor del objeto "I'm not a robot" detectado y terminará el polling.</p>
<div class="code"><pre class="code python"><a id="rest_code_6926946662074c9cba99d127440d9c84-1" name="rest_code_6926946662074c9cba99d127440d9c84-1" href="#rest_code_6926946662074c9cba99d127440d9c84-1"></a><span class="kn">import</span> <span class="nn">pyautogui</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-2" name="rest_code_6926946662074c9cba99d127440d9c84-2" href="#rest_code_6926946662074c9cba99d127440d9c84-2"></a><span class="kn">import</span> <span class="nn">cv2</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-3" name="rest_code_6926946662074c9cba99d127440d9c84-3" href="#rest_code_6926946662074c9cba99d127440d9c84-3"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-4" name="rest_code_6926946662074c9cba99d127440d9c84-4" href="#rest_code_6926946662074c9cba99d127440d9c84-4"></a>
<a id="rest_code_6926946662074c9cba99d127440d9c84-5" name="rest_code_6926946662074c9cba99d127440d9c84-5" href="#rest_code_6926946662074c9cba99d127440d9c84-5"></a><span class="c1"># Cargar plantilla o imagen de referencia</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-6" name="rest_code_6926946662074c9cba99d127440d9c84-6" href="#rest_code_6926946662074c9cba99d127440d9c84-6"></a><span class="n">plantilla</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">"./captcha.jpg"</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-7" name="rest_code_6926946662074c9cba99d127440d9c84-7" href="#rest_code_6926946662074c9cba99d127440d9c84-7"></a><span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">plantilla</span><span class="o">.</span><span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-8" name="rest_code_6926946662074c9cba99d127440d9c84-8" href="#rest_code_6926946662074c9cba99d127440d9c84-8"></a>
<a id="rest_code_6926946662074c9cba99d127440d9c84-9" name="rest_code_6926946662074c9cba99d127440d9c84-9" href="#rest_code_6926946662074c9cba99d127440d9c84-9"></a><span class="c1"># Valores de inicializacion</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-10" name="rest_code_6926946662074c9cba99d127440d9c84-10" href="#rest_code_6926946662074c9cba99d127440d9c84-10"></a><span class="n">min_val</span> <span class="o">=</span> <span class="mi">1</span>     <span class="c1">#min_val ronda en valores menores a 1</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-11" name="rest_code_6926946662074c9cba99d127440d9c84-11" href="#rest_code_6926946662074c9cba99d127440d9c84-11"></a><span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-12" name="rest_code_6926946662074c9cba99d127440d9c84-12" href="#rest_code_6926946662074c9cba99d127440d9c84-12"></a><span class="n">contMax</span><span class="o">=</span><span class="mi">60</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-13" name="rest_code_6926946662074c9cba99d127440d9c84-13" href="#rest_code_6926946662074c9cba99d127440d9c84-13"></a><span class="n">delay</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1">#1 segundos</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-14" name="rest_code_6926946662074c9cba99d127440d9c84-14" href="#rest_code_6926946662074c9cba99d127440d9c84-14"></a>
<a id="rest_code_6926946662074c9cba99d127440d9c84-15" name="rest_code_6926946662074c9cba99d127440d9c84-15" href="#rest_code_6926946662074c9cba99d127440d9c84-15"></a><span class="k">while</span> <span class="p">((</span><span class="n">min_val</span> <span class="o">&gt;</span> <span class="mf">0.015</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">cont</span><span class="o">==</span><span class="n">contMax</span><span class="p">)):</span>      <span class="c1">#Generelmente 0.015... es el valor que devuelve cuando no encuentra el objeto</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-16" name="rest_code_6926946662074c9cba99d127440d9c84-16" href="#rest_code_6926946662074c9cba99d127440d9c84-16"></a>
<a id="rest_code_6926946662074c9cba99d127440d9c84-17" name="rest_code_6926946662074c9cba99d127440d9c84-17" href="#rest_code_6926946662074c9cba99d127440d9c84-17"></a>    <span class="c1"># Realizar screenshot de la pantalla para analizarla</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-18" name="rest_code_6926946662074c9cba99d127440d9c84-18" href="#rest_code_6926946662074c9cba99d127440d9c84-18"></a>    <span class="n">imagen</span> <span class="o">=</span> <span class="n">pyautogui</span><span class="o">.</span><span class="n">screenshot</span><span class="p">()</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-19" name="rest_code_6926946662074c9cba99d127440d9c84-19" href="#rest_code_6926946662074c9cba99d127440d9c84-19"></a>    <span class="c1"># Para guardar cada screenshot</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-20" name="rest_code_6926946662074c9cba99d127440d9c84-20" href="#rest_code_6926946662074c9cba99d127440d9c84-20"></a>    <span class="n">imagen</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">"screenshot.png"</span><span class="p">)</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-21" name="rest_code_6926946662074c9cba99d127440d9c84-21" href="#rest_code_6926946662074c9cba99d127440d9c84-21"></a>
<a id="rest_code_6926946662074c9cba99d127440d9c84-22" name="rest_code_6926946662074c9cba99d127440d9c84-22" href="#rest_code_6926946662074c9cba99d127440d9c84-22"></a>    <span class="n">imagenCopy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">"screenshot.png"</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-23" name="rest_code_6926946662074c9cba99d127440d9c84-23" href="#rest_code_6926946662074c9cba99d127440d9c84-23"></a>
<a id="rest_code_6926946662074c9cba99d127440d9c84-24" name="rest_code_6926946662074c9cba99d127440d9c84-24" href="#rest_code_6926946662074c9cba99d127440d9c84-24"></a>    <span class="n">metodo</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">'cv2.TM_SQDIFF_NORMED'</span><span class="p">)</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-25" name="rest_code_6926946662074c9cba99d127440d9c84-25" href="#rest_code_6926946662074c9cba99d127440d9c84-25"></a>
<a id="rest_code_6926946662074c9cba99d127440d9c84-26" name="rest_code_6926946662074c9cba99d127440d9c84-26" href="#rest_code_6926946662074c9cba99d127440d9c84-26"></a>    <span class="c1"># Aplicar coincidencia de plantillas</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-27" name="rest_code_6926946662074c9cba99d127440d9c84-27" href="#rest_code_6926946662074c9cba99d127440d9c84-27"></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">matchTemplate</span><span class="p">(</span><span class="n">imagenCopy</span><span class="p">,</span><span class="n">plantilla</span><span class="p">,</span><span class="n">metodo</span><span class="p">)</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-28" name="rest_code_6926946662074c9cba99d127440d9c84-28" href="#rest_code_6926946662074c9cba99d127440d9c84-28"></a>    <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">minMaxLoc</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-29" name="rest_code_6926946662074c9cba99d127440d9c84-29" href="#rest_code_6926946662074c9cba99d127440d9c84-29"></a>
<a id="rest_code_6926946662074c9cba99d127440d9c84-30" name="rest_code_6926946662074c9cba99d127440d9c84-30" href="#rest_code_6926946662074c9cba99d127440d9c84-30"></a>    <span class="n">top_left</span> <span class="o">=</span> <span class="n">min_loc</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-31" name="rest_code_6926946662074c9cba99d127440d9c84-31" href="#rest_code_6926946662074c9cba99d127440d9c84-31"></a>    <span class="n">bottom_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">top_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">top_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-32" name="rest_code_6926946662074c9cba99d127440d9c84-32" href="#rest_code_6926946662074c9cba99d127440d9c84-32"></a>
<a id="rest_code_6926946662074c9cba99d127440d9c84-33" name="rest_code_6926946662074c9cba99d127440d9c84-33" href="#rest_code_6926946662074c9cba99d127440d9c84-33"></a>    <span class="n">cont</span><span class="o">=</span><span class="n">cont</span><span class="o">+</span><span class="mi">1</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-34" name="rest_code_6926946662074c9cba99d127440d9c84-34" href="#rest_code_6926946662074c9cba99d127440d9c84-34"></a>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-35" name="rest_code_6926946662074c9cba99d127440d9c84-35" href="#rest_code_6926946662074c9cba99d127440d9c84-35"></a>
<a id="rest_code_6926946662074c9cba99d127440d9c84-36" name="rest_code_6926946662074c9cba99d127440d9c84-36" href="#rest_code_6926946662074c9cba99d127440d9c84-36"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">min_val</span><span class="p">)</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-37" name="rest_code_6926946662074c9cba99d127440d9c84-37" href="#rest_code_6926946662074c9cba99d127440d9c84-37"></a>
<a id="rest_code_6926946662074c9cba99d127440d9c84-38" name="rest_code_6926946662074c9cba99d127440d9c84-38" href="#rest_code_6926946662074c9cba99d127440d9c84-38"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">min_val</span> <span class="o">&lt;</span> <span class="mf">0.015</span><span class="p">):</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-39" name="rest_code_6926946662074c9cba99d127440d9c84-39" href="#rest_code_6926946662074c9cba99d127440d9c84-39"></a>        <span class="c1"># Colocar un rectangulo en la imagen blanco y negro -&gt; solo tiene un canal por eso aparece 0</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-40" name="rest_code_6926946662074c9cba99d127440d9c84-40" href="#rest_code_6926946662074c9cba99d127440d9c84-40"></a>        <span class="c1"># (El rectangulo queda con una especie de color negro en la imagen)</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-41" name="rest_code_6926946662074c9cba99d127440d9c84-41" href="#rest_code_6926946662074c9cba99d127440d9c84-41"></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">imagenCopy</span><span class="p">,</span><span class="n">top_left</span><span class="p">,</span> <span class="n">bottom_right</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<a id="rest_code_6926946662074c9cba99d127440d9c84-42" name="rest_code_6926946662074c9cba99d127440d9c84-42" href="#rest_code_6926946662074c9cba99d127440d9c84-42"></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s2">"./coincidencia.png"</span><span class="p">,</span><span class="n">imagenCopy</span><span class="p">)</span>
</pre></div>
<p>Este es el resultado:</p>
<img alt="/images/Recetario/pasarrecaptcha/coincidencia.png" src="../../images/Recetario/pasarrecaptcha/coincidencia.png"><p>Una vez detectado el objeto "I'm not a robot" se procede a posicionar el mouse donde éste se encuentre y se procede a dar click.</p>
<div class="code"><pre class="code python"><a id="rest_code_d7279a64464940048904e5b8b608550b-1" name="rest_code_d7279a64464940048904e5b8b608550b-1" href="#rest_code_d7279a64464940048904e5b8b608550b-1"></a><span class="kn">import</span> <span class="nn">pyautogui</span>
<a id="rest_code_d7279a64464940048904e5b8b608550b-2" name="rest_code_d7279a64464940048904e5b8b608550b-2" href="#rest_code_d7279a64464940048904e5b8b608550b-2"></a>
<a id="rest_code_d7279a64464940048904e5b8b608550b-3" name="rest_code_d7279a64464940048904e5b8b608550b-3" href="#rest_code_d7279a64464940048904e5b8b608550b-3"></a><span class="c1"># Ingresar imagen que debemos buscar</span>
<a id="rest_code_d7279a64464940048904e5b8b608550b-4" name="rest_code_d7279a64464940048904e5b8b608550b-4" href="#rest_code_d7279a64464940048904e5b8b608550b-4"></a><span class="n">reCAPTCHAlocation</span> <span class="o">=</span> <span class="n">pyautogui</span><span class="o">.</span><span class="n">locateOnScreen</span><span class="p">(</span><span class="s1">'captcha.jpg'</span><span class="p">)</span>
<a id="rest_code_d7279a64464940048904e5b8b608550b-5" name="rest_code_d7279a64464940048904e5b8b608550b-5" href="#rest_code_d7279a64464940048904e5b8b608550b-5"></a>
<a id="rest_code_d7279a64464940048904e5b8b608550b-6" name="rest_code_d7279a64464940048904e5b8b608550b-6" href="#rest_code_d7279a64464940048904e5b8b608550b-6"></a><span class="c1"># Posiciones donde se encuentra el elemento buscado</span>
<a id="rest_code_d7279a64464940048904e5b8b608550b-7" name="rest_code_d7279a64464940048904e5b8b608550b-7" href="#rest_code_d7279a64464940048904e5b8b608550b-7"></a><span class="n">reCAPTCHApoint</span> <span class="o">=</span> <span class="n">pyautogui</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">reCAPTCHAlocation</span><span class="p">)</span>
<a id="rest_code_d7279a64464940048904e5b8b608550b-8" name="rest_code_d7279a64464940048904e5b8b608550b-8" href="#rest_code_d7279a64464940048904e5b8b608550b-8"></a><span class="n">reCAPTCHAx</span><span class="p">,</span> <span class="n">reCAPTCHAy</span> <span class="o">=</span> <span class="n">reCAPTCHApoint</span>
<a id="rest_code_d7279a64464940048904e5b8b608550b-9" name="rest_code_d7279a64464940048904e5b8b608550b-9" href="#rest_code_d7279a64464940048904e5b8b608550b-9"></a>
<a id="rest_code_d7279a64464940048904e5b8b608550b-10" name="rest_code_d7279a64464940048904e5b8b608550b-10" href="#rest_code_d7279a64464940048904e5b8b608550b-10"></a><span class="c1"># Hacer click en las coordenadas encontradas</span>
<a id="rest_code_d7279a64464940048904e5b8b608550b-11" name="rest_code_d7279a64464940048904e5b8b608550b-11" href="#rest_code_d7279a64464940048904e5b8b608550b-11"></a><span class="n">pyautogui</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">reCAPTCHAx</span><span class="p">,</span> <span class="n">reCAPTCHAy</span><span class="p">)</span>
</pre></div>
<img alt="/images/Recetario/pasarrecaptcha/resultado.png" src="../../images/Recetario/pasarrecaptcha/resultado.png"><p>¡Enhorabuena! Lograste superar el reCAPTCHA.</p>
    </div>    
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2024         <a href="mailto:admin@python.org.ar">Python Argentina</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

            <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script src="../../assets/js/pyar.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
