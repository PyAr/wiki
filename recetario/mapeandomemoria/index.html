<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mapeando Memoria | Python Argentina Wiki</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/bootblog.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/custom.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://wiki.python.org.ar/recetario/mapeandomemoria/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Python Argentina">
<meta property="og:site_name" content="Python Argentina Wiki">
<meta property="og:title" content="Mapeando Memoria">
<meta property="og:url" content="https://wiki.python.org.ar/recetario/mapeandomemoria/">
<meta property="og:description" content="Las funciones de abajo utilizan heapy para generar una descripción visual (en ascii) de la memoria, junto con otras estadísticas.
heapStats devuelve un diccionario pickleado, que es útil para guardarl">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-06-23T10:00:50-03:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light"><a class="navbar-brand" href="#">Navbar</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar"><span class="inicio"></span>Inicio</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../pyar/"><span class="quienes_somos"></span>Nosotros</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../foro_y_redes/"><span class="navbar_lista_de_correo"></span>Foro</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="../../"><span class="wiki"></span>Wiki</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/noticias/"><span class="news"></span>Noticias</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/irc/"><span class="irc"></span>IRC</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/eventos/"><span class="eventos"></span>Eventos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://planeta.python.org.ar/"><span class="pyar"></span>Planeta</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/trabajo/"><span class="jobs"></span>Trabajos</a>
                </li>
            </ul>
</div>
    </nav>
</div>

<!-- Header and menu bar -->
<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
<div class="col-lg-12">
    <div class="page-header">
        <div class="pull-right">
            <a href="https://github.com/PyAr/wiki/blob/master/pages/recetario/mapeandomemoria.rst" id="sourcelink" class="nav-link">Editar</a>
        </div>
        <h2>Mapeando Memoria</h2>
    </div>
    <div class="e-content entry-content" itemprop="articleBody text">
    <p>Las funciones de abajo utilizan <a class="reference external" href="http://guppy-pe.sourceforge.net/">heapy</a> para generar una descripción visual (en ascii) de la memoria, junto con otras estadísticas.</p>
<p><em>heapStats</em> devuelve un diccionario pickleado, que es útil para guardarlo en un archivo para posterior análisis por ejemplo, o para ser transmitido por algún protocolo de red, como xmlrpc o http, puesto que suele utilizarse dentro de un demonio de servidor.</p>
<p>En los datos generados, <em>"byclodo"</em> significa que son datos agrupados por <em>CLass Or Dictionary Owner</em>, lo que suele decirnos con bastante precisión quién es el culpable de mantener vivos los objetos. <em>"byrcs"</em> significa que se agrupan los datos por <em>Referrer Classification Set</em>, que significa el "clodo" del referente, útil para detectar referencias cíclicas por ejemplo.</p>
<p>Finalmente, memmap tiene el mapa de la memoria, y el detalle por si se quiere generar mapas más detallados o con diferente visualización.</p>
<p>Probablemente para un uso concreto sea necesario extender memmap antes del memmap.sort(), agregando buffers específicos de la aplicación que no caigan dentro de lo consumido por python. Por ejemplo, los objetos mmap tienen asociados grandes pedazos de memoria que no aparecerían en el mapa, y si se usan mucho en la aplicación convendría incluirlos, o buffers significativos utilizados por bibliotecas de extensión.</p>
<p>Este código sólo funciona en CPython, puesto que utiliza el hecho de que id() devuelve la dirección en memoria de un objeto. Eso no es cierto en Jython, PyPy y muchas otras implementaciones.</p>
<div class="code"><pre class="code python"><a id="rest_code_31828180f1314b51977fce7457d33ff0-1" name="rest_code_31828180f1314b51977fce7457d33ff0-1" href="#rest_code_31828180f1314b51977fce7457d33ff0-1"></a><span class="kn">import</span> <span class="nn">cPickle</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-2" name="rest_code_31828180f1314b51977fce7457d33ff0-2" href="#rest_code_31828180f1314b51977fce7457d33ff0-2"></a><span class="kn">from</span> <span class="nn">guppy</span> <span class="kn">import</span> <span class="n">hpy</span> <span class="k">as</span> <span class="n">heapy</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-3" name="rest_code_31828180f1314b51977fce7457d33ff0-3" href="#rest_code_31828180f1314b51977fce7457d33ff0-3"></a><span class="n">_heapy</span> <span class="o">=</span> <span class="n">heapy</span><span class="p">()</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-4" name="rest_code_31828180f1314b51977fce7457d33ff0-4" href="#rest_code_31828180f1314b51977fce7457d33ff0-4"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-5" name="rest_code_31828180f1314b51977fce7457d33ff0-5" href="#rest_code_31828180f1314b51977fce7457d33ff0-5"></a><span class="k">def</span> <span class="nf">report_memmap</span><span class="p">(</span><span class="n">mm</span><span class="p">):</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-6" name="rest_code_31828180f1314b51977fce7457d33ff0-6" href="#rest_code_31828180f1314b51977fce7457d33ff0-6"></a>    <span class="kn">import</span> <span class="nn">re</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-7" name="rest_code_31828180f1314b51977fce7457d33ff0-7" href="#rest_code_31828180f1314b51977fce7457d33ff0-7"></a>    <span class="kn">from</span> <span class="nn">bisect</span> <span class="kn">import</span> <span class="n">bisect_left</span><span class="p">,</span> <span class="n">bisect_right</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-8" name="rest_code_31828180f1314b51977fce7457d33ff0-8" href="#rest_code_31828180f1314b51977fce7457d33ff0-8"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-9" name="rest_code_31828180f1314b51977fce7457d33ff0-9" href="#rest_code_31828180f1314b51977fce7457d33ff0-9"></a>    <span class="n">mxsz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="n">s</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span> <span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-10" name="rest_code_31828180f1314b51977fce7457d33ff0-10" href="#rest_code_31828180f1314b51977fce7457d33ff0-10"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-11" name="rest_code_31828180f1314b51977fce7457d33ff0-11" href="#rest_code_31828180f1314b51977fce7457d33ff0-11"></a>    <span class="k">def</span> <span class="nf">usage</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">mxsz</span><span class="p">):</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-12" name="rest_code_31828180f1314b51977fce7457d33ff0-12" href="#rest_code_31828180f1314b51977fce7457d33ff0-12"></a>        <span class="n">rv</span> <span class="o">=</span> <span class="s1">' '</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-13" name="rest_code_31828180f1314b51977fce7457d33ff0-13" href="#rest_code_31828180f1314b51977fce7457d33ff0-13"></a>        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span><span class="p">[</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">mm</span><span class="p">,(</span><span class="n">mn</span><span class="o">-</span><span class="n">mxsz</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">mm</span><span class="p">,(</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))]:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-14" name="rest_code_31828180f1314b51977fce7457d33ff0-14" href="#rest_code_31828180f1314b51977fce7457d33ff0-14"></a>            <span class="k">if</span> <span class="n">mn</span><span class="o">&gt;=</span><span class="n">mx</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-15" name="rest_code_31828180f1314b51977fce7457d33ff0-15" href="#rest_code_31828180f1314b51977fce7457d33ff0-15"></a>                <span class="k">break</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-16" name="rest_code_31828180f1314b51977fce7457d33ff0-16" href="#rest_code_31828180f1314b51977fce7457d33ff0-16"></a>            <span class="n">s</span> <span class="o">+=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">16</span> <span class="c1"># add 16 bytes for malloc headers</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-17" name="rest_code_31828180f1314b51977fce7457d33ff0-17" href="#rest_code_31828180f1314b51977fce7457d33ff0-17"></a>            <span class="k">if</span> <span class="n">s</span><span class="o">&lt;=</span><span class="n">mn</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-18" name="rest_code_31828180f1314b51977fce7457d33ff0-18" href="#rest_code_31828180f1314b51977fce7457d33ff0-18"></a>                <span class="k">continue</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-19" name="rest_code_31828180f1314b51977fce7457d33ff0-19" href="#rest_code_31828180f1314b51977fce7457d33ff0-19"></a>            <span class="k">if</span> <span class="n">a</span><span class="o">&lt;</span><span class="n">mx</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-20" name="rest_code_31828180f1314b51977fce7457d33ff0-20" href="#rest_code_31828180f1314b51977fce7457d33ff0-20"></a>                <span class="n">rv</span> <span class="o">=</span> <span class="s1">'-'</span> <span class="c1"># touched the range, at least fragmented</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-21" name="rest_code_31828180f1314b51977fce7457d33ff0-21" href="#rest_code_31828180f1314b51977fce7457d33ff0-21"></a>            <span class="k">if</span> <span class="n">a</span><span class="o">&gt;</span><span class="n">mn</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-22" name="rest_code_31828180f1314b51977fce7457d33ff0-22" href="#rest_code_31828180f1314b51977fce7457d33ff0-22"></a>                <span class="c1"># cannot be fully used</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-23" name="rest_code_31828180f1314b51977fce7457d33ff0-23" href="#rest_code_31828180f1314b51977fce7457d33ff0-23"></a>                <span class="k">break</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-24" name="rest_code_31828180f1314b51977fce7457d33ff0-24" href="#rest_code_31828180f1314b51977fce7457d33ff0-24"></a>            <span class="c1">#used up to s</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-25" name="rest_code_31828180f1314b51977fce7457d33ff0-25" href="#rest_code_31828180f1314b51977fce7457d33ff0-25"></a>            <span class="n">mn</span><span class="o">=</span><span class="n">s</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-26" name="rest_code_31828180f1314b51977fce7457d33ff0-26" href="#rest_code_31828180f1314b51977fce7457d33ff0-26"></a>        <span class="k">if</span> <span class="n">mx</span> <span class="o">&lt;=</span> <span class="n">mn</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-27" name="rest_code_31828180f1314b51977fce7457d33ff0-27" href="#rest_code_31828180f1314b51977fce7457d33ff0-27"></a>            <span class="n">rv</span> <span class="o">=</span> <span class="s1">'*'</span> <span class="c1"># used in full</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-28" name="rest_code_31828180f1314b51977fce7457d33ff0-28" href="#rest_code_31828180f1314b51977fce7457d33ff0-28"></a>        <span class="k">return</span> <span class="n">rv</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-29" name="rest_code_31828180f1314b51977fce7457d33ff0-29" href="#rest_code_31828180f1314b51977fce7457d33ff0-29"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-30" name="rest_code_31828180f1314b51977fce7457d33ff0-30" href="#rest_code_31828180f1314b51977fce7457d33ff0-30"></a>    <span class="k">def</span> <span class="nf">bytes</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-31" name="rest_code_31828180f1314b51977fce7457d33ff0-31" href="#rest_code_31828180f1314b51977fce7457d33ff0-31"></a>        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-32" name="rest_code_31828180f1314b51977fce7457d33ff0-32" href="#rest_code_31828180f1314b51977fce7457d33ff0-32"></a>            <span class="k">return</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">b'</span> <span class="o">%</span> <span class="n">x</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-33" name="rest_code_31828180f1314b51977fce7457d33ff0-33" href="#rest_code_31828180f1314b51977fce7457d33ff0-33"></a>        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-34" name="rest_code_31828180f1314b51977fce7457d33ff0-34" href="#rest_code_31828180f1314b51977fce7457d33ff0-34"></a>            <span class="k">return</span> <span class="s1">'</span><span class="si">%.2f</span><span class="s1">Kb'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">1024.0</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-35" name="rest_code_31828180f1314b51977fce7457d33ff0-35" href="#rest_code_31828180f1314b51977fce7457d33ff0-35"></a>        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-36" name="rest_code_31828180f1314b51977fce7457d33ff0-36" href="#rest_code_31828180f1314b51977fce7457d33ff0-36"></a>            <span class="k">return</span> <span class="s1">'</span><span class="si">%.2f</span><span class="s1">Mb'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">1024.0</span><span class="o">/</span><span class="mf">1024.0</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-37" name="rest_code_31828180f1314b51977fce7457d33ff0-37" href="#rest_code_31828180f1314b51977fce7457d33ff0-37"></a>        <span class="k">else</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-38" name="rest_code_31828180f1314b51977fce7457d33ff0-38" href="#rest_code_31828180f1314b51977fce7457d33ff0-38"></a>            <span class="k">return</span> <span class="s1">'</span><span class="si">%.2f</span><span class="s1">Gb'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">1024.0</span><span class="o">/</span><span class="mf">1024.0</span><span class="o">/</span><span class="mf">1024.0</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-39" name="rest_code_31828180f1314b51977fce7457d33ff0-39" href="#rest_code_31828180f1314b51977fce7457d33ff0-39"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-40" name="rest_code_31828180f1314b51977fce7457d33ff0-40" href="#rest_code_31828180f1314b51977fce7457d33ff0-40"></a>    <span class="k">def</span> <span class="nf">secsize</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-41" name="rest_code_31828180f1314b51977fce7457d33ff0-41" href="#rest_code_31828180f1314b51977fce7457d33ff0-41"></a>        <span class="n">rv</span> <span class="o">=</span> <span class="mi">4096</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-42" name="rest_code_31828180f1314b51977fce7457d33ff0-42" href="#rest_code_31828180f1314b51977fce7457d33ff0-42"></a>        <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">rv</span><span class="o">/</span><span class="mi">80</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-43" name="rest_code_31828180f1314b51977fce7457d33ff0-43" href="#rest_code_31828180f1314b51977fce7457d33ff0-43"></a>            <span class="n">rv</span> <span class="o">*=</span> <span class="mi">2</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-44" name="rest_code_31828180f1314b51977fce7457d33ff0-44" href="#rest_code_31828180f1314b51977fce7457d33ff0-44"></a>        <span class="k">return</span> <span class="n">rv</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-45" name="rest_code_31828180f1314b51977fce7457d33ff0-45" href="#rest_code_31828180f1314b51977fce7457d33ff0-45"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-46" name="rest_code_31828180f1314b51977fce7457d33ff0-46" href="#rest_code_31828180f1314b51977fce7457d33ff0-46"></a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">ss</span><span class="p">):</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-47" name="rest_code_31828180f1314b51977fce7457d33ff0-47" href="#rest_code_31828180f1314b51977fce7457d33ff0-47"></a>        <span class="n">smxsz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="n">s</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span><span class="p">[</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">mm</span><span class="p">,(</span><span class="n">mn</span><span class="o">-</span><span class="n">mxsz</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">mm</span><span class="p">,(</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))]</span> <span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-48" name="rest_code_31828180f1314b51977fce7457d33ff0-48" href="#rest_code_31828180f1314b51977fce7457d33ff0-48"></a>        <span class="n">mp</span>  <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="n">usage</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">ss</span><span class="p">,</span><span class="n">smxsz</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span> <span class="p">])</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-49" name="rest_code_31828180f1314b51977fce7457d33ff0-49" href="#rest_code_31828180f1314b51977fce7457d33ff0-49"></a>        <span class="n">rv</span>  <span class="o">=</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> total, </span><span class="si">%s</span><span class="s1"> per sector</span><span class="se">\n</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">mx</span><span class="o">-</span><span class="n">mn</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-50" name="rest_code_31828180f1314b51977fce7457d33ff0-50" href="#rest_code_31828180f1314b51977fce7457d33ff0-50"></a>        <span class="n">rv</span> <span class="o">+=</span> <span class="n">lre</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'</span><span class="se">\\</span><span class="s1">1</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span><span class="n">mp</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-51" name="rest_code_31828180f1314b51977fce7457d33ff0-51" href="#rest_code_31828180f1314b51977fce7457d33ff0-51"></a>        <span class="n">rv</span> <span class="o">+=</span> <span class="s2">"""</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-52" name="rest_code_31828180f1314b51977fce7457d33ff0-52" href="#rest_code_31828180f1314b51977fce7457d33ff0-52"></a><span class="s2">        Fragmentation: </span><span class="si">%.2f%%</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-53" name="rest_code_31828180f1314b51977fce7457d33ff0-53" href="#rest_code_31828180f1314b51977fce7457d33ff0-53"></a><span class="s2">        Fragmented sectors: </span><span class="si">%d</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-54" name="rest_code_31828180f1314b51977fce7457d33ff0-54" href="#rest_code_31828180f1314b51977fce7457d33ff0-54"></a><span class="s2">        Contiguous used sectors: </span><span class="si">%d</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-55" name="rest_code_31828180f1314b51977fce7457d33ff0-55" href="#rest_code_31828180f1314b51977fce7457d33ff0-55"></a><span class="s2">        Contiguous free sectors: </span><span class="si">%d</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-56" name="rest_code_31828180f1314b51977fce7457d33ff0-56" href="#rest_code_31828180f1314b51977fce7457d33ff0-56"></a><span class="s2">        """</span> <span class="o">%</span> <span class="p">(</span> <span class="n">mp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'-'</span><span class="p">)</span><span class="o">*</span><span class="mf">100.0</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">mp</span><span class="p">),</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-57" name="rest_code_31828180f1314b51977fce7457d33ff0-57" href="#rest_code_31828180f1314b51977fce7457d33ff0-57"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'-'</span><span class="p">),</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-58" name="rest_code_31828180f1314b51977fce7457d33ff0-58" href="#rest_code_31828180f1314b51977fce7457d33ff0-58"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'*'</span><span class="p">),</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-59" name="rest_code_31828180f1314b51977fce7457d33ff0-59" href="#rest_code_31828180f1314b51977fce7457d33ff0-59"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span> <span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-60" name="rest_code_31828180f1314b51977fce7457d33ff0-60" href="#rest_code_31828180f1314b51977fce7457d33ff0-60"></a>        <span class="k">return</span> <span class="n">rv</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-61" name="rest_code_31828180f1314b51977fce7457d33ff0-61" href="#rest_code_31828180f1314b51977fce7457d33ff0-61"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-62" name="rest_code_31828180f1314b51977fce7457d33ff0-62" href="#rest_code_31828180f1314b51977fce7457d33ff0-62"></a>    <span class="k">def</span> <span class="nf">domap</span><span class="p">(</span><span class="n">filterfn</span><span class="p">):</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-63" name="rest_code_31828180f1314b51977fce7457d33ff0-63" href="#rest_code_31828180f1314b51977fce7457d33ff0-63"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">filterfn</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span><span class="p">):</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-64" name="rest_code_31828180f1314b51977fce7457d33ff0-64" href="#rest_code_31828180f1314b51977fce7457d33ff0-64"></a>            <span class="k">return</span> <span class="s1">'empty'</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-65" name="rest_code_31828180f1314b51977fce7457d33ff0-65" href="#rest_code_31828180f1314b51977fce7457d33ff0-65"></a>        <span class="n">mn</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span> <span class="k">if</span> <span class="n">filterfn</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-66" name="rest_code_31828180f1314b51977fce7457d33ff0-66" href="#rest_code_31828180f1314b51977fce7457d33ff0-66"></a>        <span class="n">mx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span> <span class="k">if</span> <span class="n">filterfn</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-67" name="rest_code_31828180f1314b51977fce7457d33ff0-67" href="#rest_code_31828180f1314b51977fce7457d33ff0-67"></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">secsize</span><span class="p">(</span><span class="n">mx</span><span class="o">-</span><span class="n">mn</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-68" name="rest_code_31828180f1314b51977fce7457d33ff0-68" href="#rest_code_31828180f1314b51977fce7457d33ff0-68"></a>        <span class="n">mn</span> <span class="o">=</span> <span class="n">mn</span><span class="o">/</span><span class="n">ss</span><span class="o">*</span><span class="n">ss</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-69" name="rest_code_31828180f1314b51977fce7457d33ff0-69" href="#rest_code_31828180f1314b51977fce7457d33ff0-69"></a>        <span class="n">mx</span> <span class="o">=</span> <span class="n">mx</span><span class="o">/</span><span class="n">ss</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">ss</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-70" name="rest_code_31828180f1314b51977fce7457d33ff0-70" href="#rest_code_31828180f1314b51977fce7457d33ff0-70"></a>        <span class="k">return</span> <span class="n">report</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-71" name="rest_code_31828180f1314b51977fce7457d33ff0-71" href="#rest_code_31828180f1314b51977fce7457d33ff0-71"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-72" name="rest_code_31828180f1314b51977fce7457d33ff0-72" href="#rest_code_31828180f1314b51977fce7457d33ff0-72"></a>    <span class="n">lre</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">'(.{80,80})'</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-73" name="rest_code_31828180f1314b51977fce7457d33ff0-73" href="#rest_code_31828180f1314b51977fce7457d33ff0-73"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-74" name="rest_code_31828180f1314b51977fce7457d33ff0-74" href="#rest_code_31828180f1314b51977fce7457d33ff0-74"></a>    <span class="n">lomap</span> <span class="o">=</span> <span class="n">domap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span>  <span class="mh">0x80000000</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-75" name="rest_code_31828180f1314b51977fce7457d33ff0-75" href="#rest_code_31828180f1314b51977fce7457d33ff0-75"></a>    <span class="n">medmap</span><span class="o">=</span> <span class="n">domap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mh">0x80000000</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mh">0x100000000</span><span class="n">L</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-76" name="rest_code_31828180f1314b51977fce7457d33ff0-76" href="#rest_code_31828180f1314b51977fce7457d33ff0-76"></a>    <span class="n">himap</span> <span class="o">=</span> <span class="n">domap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mh">0x100000000</span><span class="n">L</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-77" name="rest_code_31828180f1314b51977fce7457d33ff0-77" href="#rest_code_31828180f1314b51977fce7457d33ff0-77"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-78" name="rest_code_31828180f1314b51977fce7457d33ff0-78" href="#rest_code_31828180f1314b51977fce7457d33ff0-78"></a>    <span class="k">return</span> <span class="n">lomap</span><span class="p">,</span> <span class="n">medmap</span><span class="p">,</span> <span class="n">himap</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-79" name="rest_code_31828180f1314b51977fce7457d33ff0-79" href="#rest_code_31828180f1314b51977fce7457d33ff0-79"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-80" name="rest_code_31828180f1314b51977fce7457d33ff0-80" href="#rest_code_31828180f1314b51977fce7457d33ff0-80"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-81" name="rest_code_31828180f1314b51977fce7457d33ff0-81" href="#rest_code_31828180f1314b51977fce7457d33ff0-81"></a><span class="k">def</span> <span class="nf">heapStats</span><span class="p">():</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-82" name="rest_code_31828180f1314b51977fce7457d33ff0-82" href="#rest_code_31828180f1314b51977fce7457d33ff0-82"></a>    <span class="k">global</span> <span class="n">_debug_heap</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-83" name="rest_code_31828180f1314b51977fce7457d33ff0-83" href="#rest_code_31828180f1314b51977fce7457d33ff0-83"></a>    <span class="k">global</span> <span class="n">_heapy</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-84" name="rest_code_31828180f1314b51977fce7457d33ff0-84" href="#rest_code_31828180f1314b51977fce7457d33ff0-84"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-85" name="rest_code_31828180f1314b51977fce7457d33ff0-85" href="#rest_code_31828180f1314b51977fce7457d33ff0-85"></a>    <span class="kn">import</span> <span class="nn">StringIO</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-86" name="rest_code_31828180f1314b51977fce7457d33ff0-86" href="#rest_code_31828180f1314b51977fce7457d33ff0-86"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-87" name="rest_code_31828180f1314b51977fce7457d33ff0-87" href="#rest_code_31828180f1314b51977fce7457d33ff0-87"></a>    <span class="n">statdump</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-88" name="rest_code_31828180f1314b51977fce7457d33ff0-88" href="#rest_code_31828180f1314b51977fce7457d33ff0-88"></a>    <span class="n">heap</span> <span class="o">=</span> <span class="n">_heapy</span><span class="o">.</span><span class="n">heap</span><span class="p">()</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-89" name="rest_code_31828180f1314b51977fce7457d33ff0-89" href="#rest_code_31828180f1314b51977fce7457d33ff0-89"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-90" name="rest_code_31828180f1314b51977fce7457d33ff0-90" href="#rest_code_31828180f1314b51977fce7457d33ff0-90"></a>    <span class="k">try</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-91" name="rest_code_31828180f1314b51977fce7457d33ff0-91" href="#rest_code_31828180f1314b51977fce7457d33ff0-91"></a>        <span class="n">heap</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">statdump</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-92" name="rest_code_31828180f1314b51977fce7457d33ff0-92" href="#rest_code_31828180f1314b51977fce7457d33ff0-92"></a>    <span class="k">except</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-93" name="rest_code_31828180f1314b51977fce7457d33ff0-93" href="#rest_code_31828180f1314b51977fce7457d33ff0-93"></a>        <span class="c1"># ignore exceptions dumping... shit happens</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-94" name="rest_code_31828180f1314b51977fce7457d33ff0-94" href="#rest_code_31828180f1314b51977fce7457d33ff0-94"></a>        <span class="k">pass</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-95" name="rest_code_31828180f1314b51977fce7457d33ff0-95" href="#rest_code_31828180f1314b51977fce7457d33ff0-95"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-96" name="rest_code_31828180f1314b51977fce7457d33ff0-96" href="#rest_code_31828180f1314b51977fce7457d33ff0-96"></a>    <span class="n">statdumpu</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-97" name="rest_code_31828180f1314b51977fce7457d33ff0-97" href="#rest_code_31828180f1314b51977fce7457d33ff0-97"></a>    <span class="n">heapu</span> <span class="o">=</span> <span class="n">_heapy</span><span class="o">.</span><span class="n">heapu</span><span class="p">()</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-98" name="rest_code_31828180f1314b51977fce7457d33ff0-98" href="#rest_code_31828180f1314b51977fce7457d33ff0-98"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-99" name="rest_code_31828180f1314b51977fce7457d33ff0-99" href="#rest_code_31828180f1314b51977fce7457d33ff0-99"></a>    <span class="k">try</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-100" name="rest_code_31828180f1314b51977fce7457d33ff0-100" href="#rest_code_31828180f1314b51977fce7457d33ff0-100"></a>        <span class="n">heapu</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">statdumpu</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-101" name="rest_code_31828180f1314b51977fce7457d33ff0-101" href="#rest_code_31828180f1314b51977fce7457d33ff0-101"></a>    <span class="k">except</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-102" name="rest_code_31828180f1314b51977fce7457d33ff0-102" href="#rest_code_31828180f1314b51977fce7457d33ff0-102"></a>        <span class="c1"># ignore exceptions dumping... shit happens</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-103" name="rest_code_31828180f1314b51977fce7457d33ff0-103" href="#rest_code_31828180f1314b51977fce7457d33ff0-103"></a>        <span class="k">pass</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-104" name="rest_code_31828180f1314b51977fce7457d33ff0-104" href="#rest_code_31828180f1314b51977fce7457d33ff0-104"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-105" name="rest_code_31828180f1314b51977fce7457d33ff0-105" href="#rest_code_31828180f1314b51977fce7457d33ff0-105"></a>    <span class="n">statdumpbr</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-106" name="rest_code_31828180f1314b51977fce7457d33ff0-106" href="#rest_code_31828180f1314b51977fce7457d33ff0-106"></a>    <span class="n">heapbr</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="n">byrcs</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-107" name="rest_code_31828180f1314b51977fce7457d33ff0-107" href="#rest_code_31828180f1314b51977fce7457d33ff0-107"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-108" name="rest_code_31828180f1314b51977fce7457d33ff0-108" href="#rest_code_31828180f1314b51977fce7457d33ff0-108"></a>    <span class="k">try</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-109" name="rest_code_31828180f1314b51977fce7457d33ff0-109" href="#rest_code_31828180f1314b51977fce7457d33ff0-109"></a>        <span class="n">heapbr</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">statdumpbr</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-110" name="rest_code_31828180f1314b51977fce7457d33ff0-110" href="#rest_code_31828180f1314b51977fce7457d33ff0-110"></a>    <span class="k">except</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-111" name="rest_code_31828180f1314b51977fce7457d33ff0-111" href="#rest_code_31828180f1314b51977fce7457d33ff0-111"></a>        <span class="c1"># ignore exceptions dumping... shit happens</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-112" name="rest_code_31828180f1314b51977fce7457d33ff0-112" href="#rest_code_31828180f1314b51977fce7457d33ff0-112"></a>        <span class="k">pass</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-113" name="rest_code_31828180f1314b51977fce7457d33ff0-113" href="#rest_code_31828180f1314b51977fce7457d33ff0-113"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-114" name="rest_code_31828180f1314b51977fce7457d33ff0-114" href="#rest_code_31828180f1314b51977fce7457d33ff0-114"></a>    <span class="n">refs</span> <span class="o">=</span> <span class="kc">None</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-115" name="rest_code_31828180f1314b51977fce7457d33ff0-115" href="#rest_code_31828180f1314b51977fce7457d33ff0-115"></a>    <span class="k">try</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-116" name="rest_code_31828180f1314b51977fce7457d33ff0-116" href="#rest_code_31828180f1314b51977fce7457d33ff0-116"></a>        <span class="n">refs</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="n">stat</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-117" name="rest_code_31828180f1314b51977fce7457d33ff0-117" href="#rest_code_31828180f1314b51977fce7457d33ff0-117"></a>        <span class="n">refs</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">refs</span><span class="o">.</span><span class="n">get_rows</span><span class="p">())</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-118" name="rest_code_31828180f1314b51977fce7457d33ff0-118" href="#rest_code_31828180f1314b51977fce7457d33ff0-118"></a>        <span class="n">refs</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="o">-</span><span class="n">cmp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-119" name="rest_code_31828180f1314b51977fce7457d33ff0-119" href="#rest_code_31828180f1314b51977fce7457d33ff0-119"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-120" name="rest_code_31828180f1314b51977fce7457d33ff0-120" href="#rest_code_31828180f1314b51977fce7457d33ff0-120"></a>        <span class="n">oc</span> <span class="o">=</span> <span class="n">_heapy</span><span class="o">.</span><span class="n">Size</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">get_cli</span><span class="p">()</span><span class="o">.</span><span class="n">classify</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-121" name="rest_code_31828180f1314b51977fce7457d33ff0-121" href="#rest_code_31828180f1314b51977fce7457d33ff0-121"></a>        <span class="n">id_</span> <span class="o">=</span> <span class="nb">id</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-122" name="rest_code_31828180f1314b51977fce7457d33ff0-122" href="#rest_code_31828180f1314b51977fce7457d33ff0-122"></a>        <span class="n">str_</span> <span class="o">=</span> <span class="nb">str</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-123" name="rest_code_31828180f1314b51977fce7457d33ff0-123" href="#rest_code_31828180f1314b51977fce7457d33ff0-123"></a>        <span class="n">memmap</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">id_</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">oc</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">heap</span><span class="o">.</span><span class="n">nodes</span> <span class="p">]</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-124" name="rest_code_31828180f1314b51977fce7457d33ff0-124" href="#rest_code_31828180f1314b51977fce7457d33ff0-124"></a>    <span class="k">except</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-125" name="rest_code_31828180f1314b51977fce7457d33ff0-125" href="#rest_code_31828180f1314b51977fce7457d33ff0-125"></a>        <span class="c1"># At least the rest will be useful</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-126" name="rest_code_31828180f1314b51977fce7457d33ff0-126" href="#rest_code_31828180f1314b51977fce7457d33ff0-126"></a>        <span class="n">memmap</span> <span class="o">=</span> <span class="p">[]</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-127" name="rest_code_31828180f1314b51977fce7457d33ff0-127" href="#rest_code_31828180f1314b51977fce7457d33ff0-127"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-128" name="rest_code_31828180f1314b51977fce7457d33ff0-128" href="#rest_code_31828180f1314b51977fce7457d33ff0-128"></a>    <span class="n">memmap</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-129" name="rest_code_31828180f1314b51977fce7457d33ff0-129" href="#rest_code_31828180f1314b51977fce7457d33ff0-129"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-130" name="rest_code_31828180f1314b51977fce7457d33ff0-130" href="#rest_code_31828180f1314b51977fce7457d33ff0-130"></a>    <span class="c1"># Generate lowres reports from the memmap in four areas, lo, med, hi and very hi.</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-131" name="rest_code_31828180f1314b51977fce7457d33ff0-131" href="#rest_code_31828180f1314b51977fce7457d33ff0-131"></a>    <span class="c1"># memory (memory allocations tend to group themselves in those ranges,</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-132" name="rest_code_31828180f1314b51977fce7457d33ff0-132" href="#rest_code_31828180f1314b51977fce7457d33ff0-132"></a>    <span class="c1"># one is probably memmapped heap, the other is simple allocations and</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-133" name="rest_code_31828180f1314b51977fce7457d33ff0-133" href="#rest_code_31828180f1314b51977fce7457d33ff0-133"></a>    <span class="c1"># the medium one must be the stack). The very high area is the mmap'd area,</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-134" name="rest_code_31828180f1314b51977fce7457d33ff0-134" href="#rest_code_31828180f1314b51977fce7457d33ff0-134"></a>    <span class="c1"># where most big arrays end up.</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-135" name="rest_code_31828180f1314b51977fce7457d33ff0-135" href="#rest_code_31828180f1314b51977fce7457d33ff0-135"></a>    <span class="n">lomap</span><span class="p">,</span> <span class="n">medmap</span><span class="p">,</span> <span class="n">himap</span> <span class="o">=</span> <span class="n">report_memmap</span><span class="p">(</span><span class="n">memmap</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-136" name="rest_code_31828180f1314b51977fce7457d33ff0-136" href="#rest_code_31828180f1314b51977fce7457d33ff0-136"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-137" name="rest_code_31828180f1314b51977fce7457d33ff0-137" href="#rest_code_31828180f1314b51977fce7457d33ff0-137"></a>    <span class="c1"># Pickle the memmap, xmlrpclib doesn't like big integers</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-138" name="rest_code_31828180f1314b51977fce7457d33ff0-138" href="#rest_code_31828180f1314b51977fce7457d33ff0-138"></a>    <span class="n">memmap</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">memmap</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-139" name="rest_code_31828180f1314b51977fce7457d33ff0-139" href="#rest_code_31828180f1314b51977fce7457d33ff0-139"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-140" name="rest_code_31828180f1314b51977fce7457d33ff0-140" href="#rest_code_31828180f1314b51977fce7457d33ff0-140"></a>    <span class="k">def</span> <span class="nf">srepr</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-141" name="rest_code_31828180f1314b51977fce7457d33ff0-141" href="#rest_code_31828180f1314b51977fce7457d33ff0-141"></a>        <span class="k">try</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-142" name="rest_code_31828180f1314b51977fce7457d33ff0-142" href="#rest_code_31828180f1314b51977fce7457d33ff0-142"></a>            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-143" name="rest_code_31828180f1314b51977fce7457d33ff0-143" href="#rest_code_31828180f1314b51977fce7457d33ff0-143"></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-144" name="rest_code_31828180f1314b51977fce7457d33ff0-144" href="#rest_code_31828180f1314b51977fce7457d33ff0-144"></a>            <span class="k">return</span> <span class="s1">'ERROR: </span><span class="si">%s</span><span class="s1">'</span> <span class="p">(</span><span class="n">e</span><span class="p">,)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-145" name="rest_code_31828180f1314b51977fce7457d33ff0-145" href="#rest_code_31828180f1314b51977fce7457d33ff0-145"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-146" name="rest_code_31828180f1314b51977fce7457d33ff0-146" href="#rest_code_31828180f1314b51977fce7457d33ff0-146"></a>    <span class="n">rv</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-147" name="rest_code_31828180f1314b51977fce7457d33ff0-147" href="#rest_code_31828180f1314b51977fce7457d33ff0-147"></a>        <span class="n">byclodo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-148" name="rest_code_31828180f1314b51977fce7457d33ff0-148" href="#rest_code_31828180f1314b51977fce7457d33ff0-148"></a>            <span class="n">reachable</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">srepr</span><span class="p">,</span> <span class="p">[</span> <span class="n">heap</span><span class="p">,</span> <span class="n">heap</span><span class="o">.</span><span class="n">more</span><span class="p">,</span> <span class="n">heap</span><span class="o">.</span><span class="n">more</span><span class="o">.</span><span class="n">more</span> <span class="p">]),</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-149" name="rest_code_31828180f1314b51977fce7457d33ff0-149" href="#rest_code_31828180f1314b51977fce7457d33ff0-149"></a>            <span class="n">uncollectable</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">srepr</span><span class="p">,</span> <span class="p">[</span> <span class="n">heapu</span><span class="p">,</span> <span class="n">heapu</span><span class="o">.</span><span class="n">more</span><span class="p">,</span> <span class="n">heapu</span><span class="o">.</span><span class="n">more</span><span class="o">.</span><span class="n">more</span> <span class="p">]),</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-150" name="rest_code_31828180f1314b51977fce7457d33ff0-150" href="#rest_code_31828180f1314b51977fce7457d33ff0-150"></a>            <span class="n">statdump</span> <span class="o">=</span> <span class="n">statdump</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-151" name="rest_code_31828180f1314b51977fce7457d33ff0-151" href="#rest_code_31828180f1314b51977fce7457d33ff0-151"></a>            <span class="n">statdumpu</span> <span class="o">=</span> <span class="n">statdumpu</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-152" name="rest_code_31828180f1314b51977fce7457d33ff0-152" href="#rest_code_31828180f1314b51977fce7457d33ff0-152"></a>            <span class="n">refs</span> <span class="o">=</span> <span class="n">srepr</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-153" name="rest_code_31828180f1314b51977fce7457d33ff0-153" href="#rest_code_31828180f1314b51977fce7457d33ff0-153"></a>        <span class="p">),</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-154" name="rest_code_31828180f1314b51977fce7457d33ff0-154" href="#rest_code_31828180f1314b51977fce7457d33ff0-154"></a>        <span class="n">byrcs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-155" name="rest_code_31828180f1314b51977fce7457d33ff0-155" href="#rest_code_31828180f1314b51977fce7457d33ff0-155"></a>            <span class="n">reachable</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">srepr</span><span class="p">,</span> <span class="p">[</span> <span class="n">heapbr</span><span class="p">,</span> <span class="n">heapbr</span><span class="o">.</span><span class="n">more</span><span class="p">,</span> <span class="n">heapbr</span><span class="o">.</span><span class="n">more</span><span class="o">.</span><span class="n">more</span> <span class="p">]),</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-156" name="rest_code_31828180f1314b51977fce7457d33ff0-156" href="#rest_code_31828180f1314b51977fce7457d33ff0-156"></a>            <span class="n">statdump</span> <span class="o">=</span> <span class="n">statdumpbr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-157" name="rest_code_31828180f1314b51977fce7457d33ff0-157" href="#rest_code_31828180f1314b51977fce7457d33ff0-157"></a>        <span class="p">),</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-158" name="rest_code_31828180f1314b51977fce7457d33ff0-158" href="#rest_code_31828180f1314b51977fce7457d33ff0-158"></a>        <span class="n">memmap</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-159" name="rest_code_31828180f1314b51977fce7457d33ff0-159" href="#rest_code_31828180f1314b51977fce7457d33ff0-159"></a>            <span class="n">detail</span> <span class="o">=</span> <span class="n">memmap</span><span class="p">,</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-160" name="rest_code_31828180f1314b51977fce7457d33ff0-160" href="#rest_code_31828180f1314b51977fce7457d33ff0-160"></a>            <span class="n">lo</span> <span class="o">=</span> <span class="n">lomap</span><span class="p">,</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-161" name="rest_code_31828180f1314b51977fce7457d33ff0-161" href="#rest_code_31828180f1314b51977fce7457d33ff0-161"></a>            <span class="n">med</span> <span class="o">=</span> <span class="n">medmap</span><span class="p">,</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-162" name="rest_code_31828180f1314b51977fce7457d33ff0-162" href="#rest_code_31828180f1314b51977fce7457d33ff0-162"></a>            <span class="n">hi</span> <span class="o">=</span> <span class="n">himap</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-163" name="rest_code_31828180f1314b51977fce7457d33ff0-163" href="#rest_code_31828180f1314b51977fce7457d33ff0-163"></a>        <span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-164" name="rest_code_31828180f1314b51977fce7457d33ff0-164" href="#rest_code_31828180f1314b51977fce7457d33ff0-164"></a>    <span class="p">)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-165" name="rest_code_31828180f1314b51977fce7457d33ff0-165" href="#rest_code_31828180f1314b51977fce7457d33ff0-165"></a>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-166" name="rest_code_31828180f1314b51977fce7457d33ff0-166" href="#rest_code_31828180f1314b51977fce7457d33ff0-166"></a>    <span class="c1"># return a pickle dump, not by pure xmlrpc</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-167" name="rest_code_31828180f1314b51977fce7457d33ff0-167" href="#rest_code_31828180f1314b51977fce7457d33ff0-167"></a>    <span class="c1">#   (xmlrpc is picky, doesn't support big ints)</span>
<a id="rest_code_31828180f1314b51977fce7457d33ff0-168" name="rest_code_31828180f1314b51977fce7457d33ff0-168" href="#rest_code_31828180f1314b51977fce7457d33ff0-168"></a>    <span class="k">return</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
<!-- ############################################################################ -->
    </div>    
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2024         <a href="mailto:admin@python.org.ar">Python Argentina</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

            <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script src="../../assets/js/pyar.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
