<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mapeando Memoria | Python Argentina Wiki</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/bootblog.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/custom.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://wiki.python.org.ar/recetario/mapeandomemoria/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Python Argentina">
<meta property="og:site_name" content="Python Argentina Wiki">
<meta property="og:title" content="Mapeando Memoria">
<meta property="og:url" content="https://wiki.python.org.ar/recetario/mapeandomemoria/">
<meta property="og:description" content="Las funciones de abajo utilizan heapy para generar una descripci칩n visual (en ascii) de la memoria, junto con otras estad칤sticas.
heapStats devuelve un diccionario pickleado, que es 칰til para guardarl">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2025-03-22T12:24:52-03:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<div class="container px-0">
    <nav id="main-navbar" class="navbar navbar-expand-lg navbar-light bg-light"><a class="navbar-brand" href="https://www.python.org.ar/">Navbar</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav">
<li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar"><span class="inicio"></span>Inicio</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../pyar/"><span class="quienes_somos"></span>Nosotros</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../foro_y_redes/"><span class="navbar_lista_de_correo"></span>Foro</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="../../"><span class="wiki"></span>Wiki</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/noticias/"><span class="news"></span>Noticias</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/irc/"><span class="irc"></span>IRC</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/eventos/"><span class="eventos"></span>Eventos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://www.python.org.ar/trabajo/"><span class="jobs"></span>Trabajos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://ac.python.org.ar/"><span class="quienes_somos"></span>Asoc. Civil</a>
                </li>                
            </ul>
</div>

    </nav><div id="search_bar">
            <div id="search_overlay" style="display:none;">
                <div id="search_content">
                    <input type="text" id="search_input" placeholder="Buscar 游댍"><div id="search_count"></div>
                    <div id="search_results"></div>
                    <button id="boton_cerrar" onclick="closeSearch()">Cerrar (Esc)</button>
                </div>
            </div>
            <input type="text" id="search_input_base" placeholder="Buscar en la wiki 游댍">
</div>
</div>

<!-- Header and menu bar -->
<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
<div class="col-lg-12 px-4 py-2">
    <div class="page-header">
        <div class="pull-right">
            <a href="https://github.com/PyAr/wiki/blob/master/pages/recetario/mapeandomemoria.rst" id="sourcelink" class="nav-link">Editar</a>
        </div>
        <h2>Mapeando Memoria</h2>
    </div>
    <div class="e-content entry-content" itemprop="articleBody text">
    <p>Las funciones de abajo utilizan <a class="reference external" href="http://guppy-pe.sourceforge.net/">heapy</a> para generar una descripci칩n visual (en ascii) de la memoria, junto con otras estad칤sticas.</p>
<p><em>heapStats</em> devuelve un diccionario pickleado, que es 칰til para guardarlo en un archivo para posterior an치lisis por ejemplo, o para ser transmitido por alg칰n protocolo de red, como xmlrpc o http, puesto que suele utilizarse dentro de un demonio de servidor.</p>
<p>En los datos generados, <em>"byclodo"</em> significa que son datos agrupados por <em>CLass Or Dictionary Owner</em>, lo que suele decirnos con bastante precisi칩n qui칠n es el culpable de mantener vivos los objetos. <em>"byrcs"</em> significa que se agrupan los datos por <em>Referrer Classification Set</em>, que significa el "clodo" del referente, 칰til para detectar referencias c칤clicas por ejemplo.</p>
<p>Finalmente, memmap tiene el mapa de la memoria, y el detalle por si se quiere generar mapas m치s detallados o con diferente visualizaci칩n.</p>
<p>Probablemente para un uso concreto sea necesario extender memmap antes del memmap.sort(), agregando buffers espec칤ficos de la aplicaci칩n que no caigan dentro de lo consumido por python. Por ejemplo, los objetos mmap tienen asociados grandes pedazos de memoria que no aparecer칤an en el mapa, y si se usan mucho en la aplicaci칩n convendr칤a incluirlos, o buffers significativos utilizados por bibliotecas de extensi칩n.</p>
<p>Este c칩digo s칩lo funciona en CPython, puesto que utiliza el hecho de que id() devuelve la direcci칩n en memoria de un objeto. Eso no es cierto en Jython, PyPy y muchas otras implementaciones.</p>
<div class="code"><pre class="code python"><a id="rest_code_5339c6e449cc451aa21e46846febdaee-1" name="rest_code_5339c6e449cc451aa21e46846febdaee-1" href="#rest_code_5339c6e449cc451aa21e46846febdaee-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">cPickle</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-2" name="rest_code_5339c6e449cc451aa21e46846febdaee-2" href="#rest_code_5339c6e449cc451aa21e46846febdaee-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">guppy</span><span class="w"> </span><span class="kn">import</span> <span class="n">hpy</span> <span class="k">as</span> <span class="n">heapy</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-3" name="rest_code_5339c6e449cc451aa21e46846febdaee-3" href="#rest_code_5339c6e449cc451aa21e46846febdaee-3"></a><span class="n">_heapy</span> <span class="o">=</span> <span class="n">heapy</span><span class="p">()</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-4" name="rest_code_5339c6e449cc451aa21e46846febdaee-4" href="#rest_code_5339c6e449cc451aa21e46846febdaee-4"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-5" name="rest_code_5339c6e449cc451aa21e46846febdaee-5" href="#rest_code_5339c6e449cc451aa21e46846febdaee-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">report_memmap</span><span class="p">(</span><span class="n">mm</span><span class="p">):</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-6" name="rest_code_5339c6e449cc451aa21e46846febdaee-6" href="#rest_code_5339c6e449cc451aa21e46846febdaee-6"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-7" name="rest_code_5339c6e449cc451aa21e46846febdaee-7" href="#rest_code_5339c6e449cc451aa21e46846febdaee-7"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">bisect</span><span class="w"> </span><span class="kn">import</span> <span class="n">bisect_left</span><span class="p">,</span> <span class="n">bisect_right</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-8" name="rest_code_5339c6e449cc451aa21e46846febdaee-8" href="#rest_code_5339c6e449cc451aa21e46846febdaee-8"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-9" name="rest_code_5339c6e449cc451aa21e46846febdaee-9" href="#rest_code_5339c6e449cc451aa21e46846febdaee-9"></a>    <span class="n">mxsz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="n">s</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span> <span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-10" name="rest_code_5339c6e449cc451aa21e46846febdaee-10" href="#rest_code_5339c6e449cc451aa21e46846febdaee-10"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-11" name="rest_code_5339c6e449cc451aa21e46846febdaee-11" href="#rest_code_5339c6e449cc451aa21e46846febdaee-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">mxsz</span><span class="p">):</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-12" name="rest_code_5339c6e449cc451aa21e46846febdaee-12" href="#rest_code_5339c6e449cc451aa21e46846febdaee-12"></a>        <span class="n">rv</span> <span class="o">=</span> <span class="s1">' '</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-13" name="rest_code_5339c6e449cc451aa21e46846febdaee-13" href="#rest_code_5339c6e449cc451aa21e46846febdaee-13"></a>        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span><span class="p">[</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">mm</span><span class="p">,(</span><span class="n">mn</span><span class="o">-</span><span class="n">mxsz</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">mm</span><span class="p">,(</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))]:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-14" name="rest_code_5339c6e449cc451aa21e46846febdaee-14" href="#rest_code_5339c6e449cc451aa21e46846febdaee-14"></a>            <span class="k">if</span> <span class="n">mn</span><span class="o">&gt;=</span><span class="n">mx</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-15" name="rest_code_5339c6e449cc451aa21e46846febdaee-15" href="#rest_code_5339c6e449cc451aa21e46846febdaee-15"></a>                <span class="k">break</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-16" name="rest_code_5339c6e449cc451aa21e46846febdaee-16" href="#rest_code_5339c6e449cc451aa21e46846febdaee-16"></a>            <span class="n">s</span> <span class="o">+=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">16</span> <span class="c1"># add 16 bytes for malloc headers</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-17" name="rest_code_5339c6e449cc451aa21e46846febdaee-17" href="#rest_code_5339c6e449cc451aa21e46846febdaee-17"></a>            <span class="k">if</span> <span class="n">s</span><span class="o">&lt;=</span><span class="n">mn</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-18" name="rest_code_5339c6e449cc451aa21e46846febdaee-18" href="#rest_code_5339c6e449cc451aa21e46846febdaee-18"></a>                <span class="k">continue</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-19" name="rest_code_5339c6e449cc451aa21e46846febdaee-19" href="#rest_code_5339c6e449cc451aa21e46846febdaee-19"></a>            <span class="k">if</span> <span class="n">a</span><span class="o">&lt;</span><span class="n">mx</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-20" name="rest_code_5339c6e449cc451aa21e46846febdaee-20" href="#rest_code_5339c6e449cc451aa21e46846febdaee-20"></a>                <span class="n">rv</span> <span class="o">=</span> <span class="s1">'-'</span> <span class="c1"># touched the range, at least fragmented</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-21" name="rest_code_5339c6e449cc451aa21e46846febdaee-21" href="#rest_code_5339c6e449cc451aa21e46846febdaee-21"></a>            <span class="k">if</span> <span class="n">a</span><span class="o">&gt;</span><span class="n">mn</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-22" name="rest_code_5339c6e449cc451aa21e46846febdaee-22" href="#rest_code_5339c6e449cc451aa21e46846febdaee-22"></a>                <span class="c1"># cannot be fully used</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-23" name="rest_code_5339c6e449cc451aa21e46846febdaee-23" href="#rest_code_5339c6e449cc451aa21e46846febdaee-23"></a>                <span class="k">break</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-24" name="rest_code_5339c6e449cc451aa21e46846febdaee-24" href="#rest_code_5339c6e449cc451aa21e46846febdaee-24"></a>            <span class="c1">#used up to s</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-25" name="rest_code_5339c6e449cc451aa21e46846febdaee-25" href="#rest_code_5339c6e449cc451aa21e46846febdaee-25"></a>            <span class="n">mn</span><span class="o">=</span><span class="n">s</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-26" name="rest_code_5339c6e449cc451aa21e46846febdaee-26" href="#rest_code_5339c6e449cc451aa21e46846febdaee-26"></a>        <span class="k">if</span> <span class="n">mx</span> <span class="o">&lt;=</span> <span class="n">mn</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-27" name="rest_code_5339c6e449cc451aa21e46846febdaee-27" href="#rest_code_5339c6e449cc451aa21e46846febdaee-27"></a>            <span class="n">rv</span> <span class="o">=</span> <span class="s1">'*'</span> <span class="c1"># used in full</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-28" name="rest_code_5339c6e449cc451aa21e46846febdaee-28" href="#rest_code_5339c6e449cc451aa21e46846febdaee-28"></a>        <span class="k">return</span> <span class="n">rv</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-29" name="rest_code_5339c6e449cc451aa21e46846febdaee-29" href="#rest_code_5339c6e449cc451aa21e46846febdaee-29"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-30" name="rest_code_5339c6e449cc451aa21e46846febdaee-30" href="#rest_code_5339c6e449cc451aa21e46846febdaee-30"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">bytes</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-31" name="rest_code_5339c6e449cc451aa21e46846febdaee-31" href="#rest_code_5339c6e449cc451aa21e46846febdaee-31"></a>        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-32" name="rest_code_5339c6e449cc451aa21e46846febdaee-32" href="#rest_code_5339c6e449cc451aa21e46846febdaee-32"></a>            <span class="k">return</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">b'</span> <span class="o">%</span> <span class="n">x</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-33" name="rest_code_5339c6e449cc451aa21e46846febdaee-33" href="#rest_code_5339c6e449cc451aa21e46846febdaee-33"></a>        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-34" name="rest_code_5339c6e449cc451aa21e46846febdaee-34" href="#rest_code_5339c6e449cc451aa21e46846febdaee-34"></a>            <span class="k">return</span> <span class="s1">'</span><span class="si">%.2f</span><span class="s1">Kb'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">1024.0</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-35" name="rest_code_5339c6e449cc451aa21e46846febdaee-35" href="#rest_code_5339c6e449cc451aa21e46846febdaee-35"></a>        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-36" name="rest_code_5339c6e449cc451aa21e46846febdaee-36" href="#rest_code_5339c6e449cc451aa21e46846febdaee-36"></a>            <span class="k">return</span> <span class="s1">'</span><span class="si">%.2f</span><span class="s1">Mb'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">1024.0</span><span class="o">/</span><span class="mf">1024.0</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-37" name="rest_code_5339c6e449cc451aa21e46846febdaee-37" href="#rest_code_5339c6e449cc451aa21e46846febdaee-37"></a>        <span class="k">else</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-38" name="rest_code_5339c6e449cc451aa21e46846febdaee-38" href="#rest_code_5339c6e449cc451aa21e46846febdaee-38"></a>            <span class="k">return</span> <span class="s1">'</span><span class="si">%.2f</span><span class="s1">Gb'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">1024.0</span><span class="o">/</span><span class="mf">1024.0</span><span class="o">/</span><span class="mf">1024.0</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-39" name="rest_code_5339c6e449cc451aa21e46846febdaee-39" href="#rest_code_5339c6e449cc451aa21e46846febdaee-39"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-40" name="rest_code_5339c6e449cc451aa21e46846febdaee-40" href="#rest_code_5339c6e449cc451aa21e46846febdaee-40"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">secsize</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-41" name="rest_code_5339c6e449cc451aa21e46846febdaee-41" href="#rest_code_5339c6e449cc451aa21e46846febdaee-41"></a>        <span class="n">rv</span> <span class="o">=</span> <span class="mi">4096</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-42" name="rest_code_5339c6e449cc451aa21e46846febdaee-42" href="#rest_code_5339c6e449cc451aa21e46846febdaee-42"></a>        <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">rv</span><span class="o">/</span><span class="mi">80</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-43" name="rest_code_5339c6e449cc451aa21e46846febdaee-43" href="#rest_code_5339c6e449cc451aa21e46846febdaee-43"></a>            <span class="n">rv</span> <span class="o">*=</span> <span class="mi">2</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-44" name="rest_code_5339c6e449cc451aa21e46846febdaee-44" href="#rest_code_5339c6e449cc451aa21e46846febdaee-44"></a>        <span class="k">return</span> <span class="n">rv</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-45" name="rest_code_5339c6e449cc451aa21e46846febdaee-45" href="#rest_code_5339c6e449cc451aa21e46846febdaee-45"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-46" name="rest_code_5339c6e449cc451aa21e46846febdaee-46" href="#rest_code_5339c6e449cc451aa21e46846febdaee-46"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">report</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">ss</span><span class="p">):</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-47" name="rest_code_5339c6e449cc451aa21e46846febdaee-47" href="#rest_code_5339c6e449cc451aa21e46846febdaee-47"></a>        <span class="n">smxsz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="n">s</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span><span class="p">[</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">mm</span><span class="p">,(</span><span class="n">mn</span><span class="o">-</span><span class="n">mxsz</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">mm</span><span class="p">,(</span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))]</span> <span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-48" name="rest_code_5339c6e449cc451aa21e46846febdaee-48" href="#rest_code_5339c6e449cc451aa21e46846febdaee-48"></a>        <span class="n">mp</span>  <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="n">usage</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">ss</span><span class="p">,</span><span class="n">smxsz</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span> <span class="p">])</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-49" name="rest_code_5339c6e449cc451aa21e46846febdaee-49" href="#rest_code_5339c6e449cc451aa21e46846febdaee-49"></a>        <span class="n">rv</span>  <span class="o">=</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> total, </span><span class="si">%s</span><span class="s1"> per sector</span><span class="se">\n</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">mx</span><span class="o">-</span><span class="n">mn</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-50" name="rest_code_5339c6e449cc451aa21e46846febdaee-50" href="#rest_code_5339c6e449cc451aa21e46846febdaee-50"></a>        <span class="n">rv</span> <span class="o">+=</span> <span class="n">lre</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'</span><span class="se">\\</span><span class="s1">1</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span><span class="n">mp</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-51" name="rest_code_5339c6e449cc451aa21e46846febdaee-51" href="#rest_code_5339c6e449cc451aa21e46846febdaee-51"></a>        <span class="n">rv</span> <span class="o">+=</span> <span class="s2">"""</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-52" name="rest_code_5339c6e449cc451aa21e46846febdaee-52" href="#rest_code_5339c6e449cc451aa21e46846febdaee-52"></a><span class="s2">        Fragmentation: </span><span class="si">%.2f%%</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-53" name="rest_code_5339c6e449cc451aa21e46846febdaee-53" href="#rest_code_5339c6e449cc451aa21e46846febdaee-53"></a><span class="s2">        Fragmented sectors: </span><span class="si">%d</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-54" name="rest_code_5339c6e449cc451aa21e46846febdaee-54" href="#rest_code_5339c6e449cc451aa21e46846febdaee-54"></a><span class="s2">        Contiguous used sectors: </span><span class="si">%d</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-55" name="rest_code_5339c6e449cc451aa21e46846febdaee-55" href="#rest_code_5339c6e449cc451aa21e46846febdaee-55"></a><span class="s2">        Contiguous free sectors: </span><span class="si">%d</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-56" name="rest_code_5339c6e449cc451aa21e46846febdaee-56" href="#rest_code_5339c6e449cc451aa21e46846febdaee-56"></a><span class="s2">        """</span> <span class="o">%</span> <span class="p">(</span> <span class="n">mp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'-'</span><span class="p">)</span><span class="o">*</span><span class="mf">100.0</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">mp</span><span class="p">),</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-57" name="rest_code_5339c6e449cc451aa21e46846febdaee-57" href="#rest_code_5339c6e449cc451aa21e46846febdaee-57"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'-'</span><span class="p">),</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-58" name="rest_code_5339c6e449cc451aa21e46846febdaee-58" href="#rest_code_5339c6e449cc451aa21e46846febdaee-58"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'*'</span><span class="p">),</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-59" name="rest_code_5339c6e449cc451aa21e46846febdaee-59" href="#rest_code_5339c6e449cc451aa21e46846febdaee-59"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span> <span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-60" name="rest_code_5339c6e449cc451aa21e46846febdaee-60" href="#rest_code_5339c6e449cc451aa21e46846febdaee-60"></a>        <span class="k">return</span> <span class="n">rv</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-61" name="rest_code_5339c6e449cc451aa21e46846febdaee-61" href="#rest_code_5339c6e449cc451aa21e46846febdaee-61"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-62" name="rest_code_5339c6e449cc451aa21e46846febdaee-62" href="#rest_code_5339c6e449cc451aa21e46846febdaee-62"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">domap</span><span class="p">(</span><span class="n">filterfn</span><span class="p">):</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-63" name="rest_code_5339c6e449cc451aa21e46846febdaee-63" href="#rest_code_5339c6e449cc451aa21e46846febdaee-63"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">filterfn</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span><span class="p">):</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-64" name="rest_code_5339c6e449cc451aa21e46846febdaee-64" href="#rest_code_5339c6e449cc451aa21e46846febdaee-64"></a>            <span class="k">return</span> <span class="s1">'empty'</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-65" name="rest_code_5339c6e449cc451aa21e46846febdaee-65" href="#rest_code_5339c6e449cc451aa21e46846febdaee-65"></a>        <span class="n">mn</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span> <span class="k">if</span> <span class="n">filterfn</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-66" name="rest_code_5339c6e449cc451aa21e46846febdaee-66" href="#rest_code_5339c6e449cc451aa21e46846febdaee-66"></a>        <span class="n">mx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">mm</span> <span class="k">if</span> <span class="n">filterfn</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-67" name="rest_code_5339c6e449cc451aa21e46846febdaee-67" href="#rest_code_5339c6e449cc451aa21e46846febdaee-67"></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">secsize</span><span class="p">(</span><span class="n">mx</span><span class="o">-</span><span class="n">mn</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-68" name="rest_code_5339c6e449cc451aa21e46846febdaee-68" href="#rest_code_5339c6e449cc451aa21e46846febdaee-68"></a>        <span class="n">mn</span> <span class="o">=</span> <span class="n">mn</span><span class="o">/</span><span class="n">ss</span><span class="o">*</span><span class="n">ss</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-69" name="rest_code_5339c6e449cc451aa21e46846febdaee-69" href="#rest_code_5339c6e449cc451aa21e46846febdaee-69"></a>        <span class="n">mx</span> <span class="o">=</span> <span class="n">mx</span><span class="o">/</span><span class="n">ss</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">ss</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-70" name="rest_code_5339c6e449cc451aa21e46846febdaee-70" href="#rest_code_5339c6e449cc451aa21e46846febdaee-70"></a>        <span class="k">return</span> <span class="n">report</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-71" name="rest_code_5339c6e449cc451aa21e46846febdaee-71" href="#rest_code_5339c6e449cc451aa21e46846febdaee-71"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-72" name="rest_code_5339c6e449cc451aa21e46846febdaee-72" href="#rest_code_5339c6e449cc451aa21e46846febdaee-72"></a>    <span class="n">lre</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">'(.{80,80})'</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-73" name="rest_code_5339c6e449cc451aa21e46846febdaee-73" href="#rest_code_5339c6e449cc451aa21e46846febdaee-73"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-74" name="rest_code_5339c6e449cc451aa21e46846febdaee-74" href="#rest_code_5339c6e449cc451aa21e46846febdaee-74"></a>    <span class="n">lomap</span> <span class="o">=</span> <span class="n">domap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span>  <span class="mh">0x80000000</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-75" name="rest_code_5339c6e449cc451aa21e46846febdaee-75" href="#rest_code_5339c6e449cc451aa21e46846febdaee-75"></a>    <span class="n">medmap</span><span class="o">=</span> <span class="n">domap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mh">0x80000000</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mh">0x100000000</span><span class="n">L</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-76" name="rest_code_5339c6e449cc451aa21e46846febdaee-76" href="#rest_code_5339c6e449cc451aa21e46846febdaee-76"></a>    <span class="n">himap</span> <span class="o">=</span> <span class="n">domap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mh">0x100000000</span><span class="n">L</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-77" name="rest_code_5339c6e449cc451aa21e46846febdaee-77" href="#rest_code_5339c6e449cc451aa21e46846febdaee-77"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-78" name="rest_code_5339c6e449cc451aa21e46846febdaee-78" href="#rest_code_5339c6e449cc451aa21e46846febdaee-78"></a>    <span class="k">return</span> <span class="n">lomap</span><span class="p">,</span> <span class="n">medmap</span><span class="p">,</span> <span class="n">himap</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-79" name="rest_code_5339c6e449cc451aa21e46846febdaee-79" href="#rest_code_5339c6e449cc451aa21e46846febdaee-79"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-80" name="rest_code_5339c6e449cc451aa21e46846febdaee-80" href="#rest_code_5339c6e449cc451aa21e46846febdaee-80"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-81" name="rest_code_5339c6e449cc451aa21e46846febdaee-81" href="#rest_code_5339c6e449cc451aa21e46846febdaee-81"></a><span class="k">def</span><span class="w"> </span><span class="nf">heapStats</span><span class="p">():</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-82" name="rest_code_5339c6e449cc451aa21e46846febdaee-82" href="#rest_code_5339c6e449cc451aa21e46846febdaee-82"></a>    <span class="k">global</span> <span class="n">_debug_heap</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-83" name="rest_code_5339c6e449cc451aa21e46846febdaee-83" href="#rest_code_5339c6e449cc451aa21e46846febdaee-83"></a>    <span class="k">global</span> <span class="n">_heapy</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-84" name="rest_code_5339c6e449cc451aa21e46846febdaee-84" href="#rest_code_5339c6e449cc451aa21e46846febdaee-84"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-85" name="rest_code_5339c6e449cc451aa21e46846febdaee-85" href="#rest_code_5339c6e449cc451aa21e46846febdaee-85"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">StringIO</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-86" name="rest_code_5339c6e449cc451aa21e46846febdaee-86" href="#rest_code_5339c6e449cc451aa21e46846febdaee-86"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-87" name="rest_code_5339c6e449cc451aa21e46846febdaee-87" href="#rest_code_5339c6e449cc451aa21e46846febdaee-87"></a>    <span class="n">statdump</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-88" name="rest_code_5339c6e449cc451aa21e46846febdaee-88" href="#rest_code_5339c6e449cc451aa21e46846febdaee-88"></a>    <span class="n">heap</span> <span class="o">=</span> <span class="n">_heapy</span><span class="o">.</span><span class="n">heap</span><span class="p">()</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-89" name="rest_code_5339c6e449cc451aa21e46846febdaee-89" href="#rest_code_5339c6e449cc451aa21e46846febdaee-89"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-90" name="rest_code_5339c6e449cc451aa21e46846febdaee-90" href="#rest_code_5339c6e449cc451aa21e46846febdaee-90"></a>    <span class="k">try</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-91" name="rest_code_5339c6e449cc451aa21e46846febdaee-91" href="#rest_code_5339c6e449cc451aa21e46846febdaee-91"></a>        <span class="n">heap</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">statdump</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-92" name="rest_code_5339c6e449cc451aa21e46846febdaee-92" href="#rest_code_5339c6e449cc451aa21e46846febdaee-92"></a>    <span class="k">except</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-93" name="rest_code_5339c6e449cc451aa21e46846febdaee-93" href="#rest_code_5339c6e449cc451aa21e46846febdaee-93"></a>        <span class="c1"># ignore exceptions dumping... shit happens</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-94" name="rest_code_5339c6e449cc451aa21e46846febdaee-94" href="#rest_code_5339c6e449cc451aa21e46846febdaee-94"></a>        <span class="k">pass</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-95" name="rest_code_5339c6e449cc451aa21e46846febdaee-95" href="#rest_code_5339c6e449cc451aa21e46846febdaee-95"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-96" name="rest_code_5339c6e449cc451aa21e46846febdaee-96" href="#rest_code_5339c6e449cc451aa21e46846febdaee-96"></a>    <span class="n">statdumpu</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-97" name="rest_code_5339c6e449cc451aa21e46846febdaee-97" href="#rest_code_5339c6e449cc451aa21e46846febdaee-97"></a>    <span class="n">heapu</span> <span class="o">=</span> <span class="n">_heapy</span><span class="o">.</span><span class="n">heapu</span><span class="p">()</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-98" name="rest_code_5339c6e449cc451aa21e46846febdaee-98" href="#rest_code_5339c6e449cc451aa21e46846febdaee-98"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-99" name="rest_code_5339c6e449cc451aa21e46846febdaee-99" href="#rest_code_5339c6e449cc451aa21e46846febdaee-99"></a>    <span class="k">try</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-100" name="rest_code_5339c6e449cc451aa21e46846febdaee-100" href="#rest_code_5339c6e449cc451aa21e46846febdaee-100"></a>        <span class="n">heapu</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">statdumpu</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-101" name="rest_code_5339c6e449cc451aa21e46846febdaee-101" href="#rest_code_5339c6e449cc451aa21e46846febdaee-101"></a>    <span class="k">except</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-102" name="rest_code_5339c6e449cc451aa21e46846febdaee-102" href="#rest_code_5339c6e449cc451aa21e46846febdaee-102"></a>        <span class="c1"># ignore exceptions dumping... shit happens</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-103" name="rest_code_5339c6e449cc451aa21e46846febdaee-103" href="#rest_code_5339c6e449cc451aa21e46846febdaee-103"></a>        <span class="k">pass</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-104" name="rest_code_5339c6e449cc451aa21e46846febdaee-104" href="#rest_code_5339c6e449cc451aa21e46846febdaee-104"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-105" name="rest_code_5339c6e449cc451aa21e46846febdaee-105" href="#rest_code_5339c6e449cc451aa21e46846febdaee-105"></a>    <span class="n">statdumpbr</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-106" name="rest_code_5339c6e449cc451aa21e46846febdaee-106" href="#rest_code_5339c6e449cc451aa21e46846febdaee-106"></a>    <span class="n">heapbr</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="n">byrcs</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-107" name="rest_code_5339c6e449cc451aa21e46846febdaee-107" href="#rest_code_5339c6e449cc451aa21e46846febdaee-107"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-108" name="rest_code_5339c6e449cc451aa21e46846febdaee-108" href="#rest_code_5339c6e449cc451aa21e46846febdaee-108"></a>    <span class="k">try</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-109" name="rest_code_5339c6e449cc451aa21e46846febdaee-109" href="#rest_code_5339c6e449cc451aa21e46846febdaee-109"></a>        <span class="n">heapbr</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">statdumpbr</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-110" name="rest_code_5339c6e449cc451aa21e46846febdaee-110" href="#rest_code_5339c6e449cc451aa21e46846febdaee-110"></a>    <span class="k">except</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-111" name="rest_code_5339c6e449cc451aa21e46846febdaee-111" href="#rest_code_5339c6e449cc451aa21e46846febdaee-111"></a>        <span class="c1"># ignore exceptions dumping... shit happens</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-112" name="rest_code_5339c6e449cc451aa21e46846febdaee-112" href="#rest_code_5339c6e449cc451aa21e46846febdaee-112"></a>        <span class="k">pass</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-113" name="rest_code_5339c6e449cc451aa21e46846febdaee-113" href="#rest_code_5339c6e449cc451aa21e46846febdaee-113"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-114" name="rest_code_5339c6e449cc451aa21e46846febdaee-114" href="#rest_code_5339c6e449cc451aa21e46846febdaee-114"></a>    <span class="n">refs</span> <span class="o">=</span> <span class="kc">None</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-115" name="rest_code_5339c6e449cc451aa21e46846febdaee-115" href="#rest_code_5339c6e449cc451aa21e46846febdaee-115"></a>    <span class="k">try</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-116" name="rest_code_5339c6e449cc451aa21e46846febdaee-116" href="#rest_code_5339c6e449cc451aa21e46846febdaee-116"></a>        <span class="n">refs</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="n">stat</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-117" name="rest_code_5339c6e449cc451aa21e46846febdaee-117" href="#rest_code_5339c6e449cc451aa21e46846febdaee-117"></a>        <span class="n">refs</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">refs</span><span class="o">.</span><span class="n">get_rows</span><span class="p">())</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-118" name="rest_code_5339c6e449cc451aa21e46846febdaee-118" href="#rest_code_5339c6e449cc451aa21e46846febdaee-118"></a>        <span class="n">refs</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="o">-</span><span class="n">cmp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-119" name="rest_code_5339c6e449cc451aa21e46846febdaee-119" href="#rest_code_5339c6e449cc451aa21e46846febdaee-119"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-120" name="rest_code_5339c6e449cc451aa21e46846febdaee-120" href="#rest_code_5339c6e449cc451aa21e46846febdaee-120"></a>        <span class="n">oc</span> <span class="o">=</span> <span class="n">_heapy</span><span class="o">.</span><span class="n">Size</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">get_cli</span><span class="p">()</span><span class="o">.</span><span class="n">classify</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-121" name="rest_code_5339c6e449cc451aa21e46846febdaee-121" href="#rest_code_5339c6e449cc451aa21e46846febdaee-121"></a>        <span class="n">id_</span> <span class="o">=</span> <span class="nb">id</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-122" name="rest_code_5339c6e449cc451aa21e46846febdaee-122" href="#rest_code_5339c6e449cc451aa21e46846febdaee-122"></a>        <span class="n">str_</span> <span class="o">=</span> <span class="nb">str</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-123" name="rest_code_5339c6e449cc451aa21e46846febdaee-123" href="#rest_code_5339c6e449cc451aa21e46846febdaee-123"></a>        <span class="n">memmap</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">id_</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">oc</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">heap</span><span class="o">.</span><span class="n">nodes</span> <span class="p">]</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-124" name="rest_code_5339c6e449cc451aa21e46846febdaee-124" href="#rest_code_5339c6e449cc451aa21e46846febdaee-124"></a>    <span class="k">except</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-125" name="rest_code_5339c6e449cc451aa21e46846febdaee-125" href="#rest_code_5339c6e449cc451aa21e46846febdaee-125"></a>        <span class="c1"># At least the rest will be useful</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-126" name="rest_code_5339c6e449cc451aa21e46846febdaee-126" href="#rest_code_5339c6e449cc451aa21e46846febdaee-126"></a>        <span class="n">memmap</span> <span class="o">=</span> <span class="p">[]</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-127" name="rest_code_5339c6e449cc451aa21e46846febdaee-127" href="#rest_code_5339c6e449cc451aa21e46846febdaee-127"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-128" name="rest_code_5339c6e449cc451aa21e46846febdaee-128" href="#rest_code_5339c6e449cc451aa21e46846febdaee-128"></a>    <span class="n">memmap</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-129" name="rest_code_5339c6e449cc451aa21e46846febdaee-129" href="#rest_code_5339c6e449cc451aa21e46846febdaee-129"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-130" name="rest_code_5339c6e449cc451aa21e46846febdaee-130" href="#rest_code_5339c6e449cc451aa21e46846febdaee-130"></a>    <span class="c1"># Generate lowres reports from the memmap in four areas, lo, med, hi and very hi.</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-131" name="rest_code_5339c6e449cc451aa21e46846febdaee-131" href="#rest_code_5339c6e449cc451aa21e46846febdaee-131"></a>    <span class="c1"># memory (memory allocations tend to group themselves in those ranges,</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-132" name="rest_code_5339c6e449cc451aa21e46846febdaee-132" href="#rest_code_5339c6e449cc451aa21e46846febdaee-132"></a>    <span class="c1"># one is probably memmapped heap, the other is simple allocations and</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-133" name="rest_code_5339c6e449cc451aa21e46846febdaee-133" href="#rest_code_5339c6e449cc451aa21e46846febdaee-133"></a>    <span class="c1"># the medium one must be the stack). The very high area is the mmap'd area,</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-134" name="rest_code_5339c6e449cc451aa21e46846febdaee-134" href="#rest_code_5339c6e449cc451aa21e46846febdaee-134"></a>    <span class="c1"># where most big arrays end up.</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-135" name="rest_code_5339c6e449cc451aa21e46846febdaee-135" href="#rest_code_5339c6e449cc451aa21e46846febdaee-135"></a>    <span class="n">lomap</span><span class="p">,</span> <span class="n">medmap</span><span class="p">,</span> <span class="n">himap</span> <span class="o">=</span> <span class="n">report_memmap</span><span class="p">(</span><span class="n">memmap</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-136" name="rest_code_5339c6e449cc451aa21e46846febdaee-136" href="#rest_code_5339c6e449cc451aa21e46846febdaee-136"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-137" name="rest_code_5339c6e449cc451aa21e46846febdaee-137" href="#rest_code_5339c6e449cc451aa21e46846febdaee-137"></a>    <span class="c1"># Pickle the memmap, xmlrpclib doesn't like big integers</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-138" name="rest_code_5339c6e449cc451aa21e46846febdaee-138" href="#rest_code_5339c6e449cc451aa21e46846febdaee-138"></a>    <span class="n">memmap</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">memmap</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-139" name="rest_code_5339c6e449cc451aa21e46846febdaee-139" href="#rest_code_5339c6e449cc451aa21e46846febdaee-139"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-140" name="rest_code_5339c6e449cc451aa21e46846febdaee-140" href="#rest_code_5339c6e449cc451aa21e46846febdaee-140"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">srepr</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-141" name="rest_code_5339c6e449cc451aa21e46846febdaee-141" href="#rest_code_5339c6e449cc451aa21e46846febdaee-141"></a>        <span class="k">try</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-142" name="rest_code_5339c6e449cc451aa21e46846febdaee-142" href="#rest_code_5339c6e449cc451aa21e46846febdaee-142"></a>            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-143" name="rest_code_5339c6e449cc451aa21e46846febdaee-143" href="#rest_code_5339c6e449cc451aa21e46846febdaee-143"></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-144" name="rest_code_5339c6e449cc451aa21e46846febdaee-144" href="#rest_code_5339c6e449cc451aa21e46846febdaee-144"></a>            <span class="k">return</span> <span class="s1">'ERROR: </span><span class="si">%s</span><span class="s1">'</span> <span class="p">(</span><span class="n">e</span><span class="p">,)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-145" name="rest_code_5339c6e449cc451aa21e46846febdaee-145" href="#rest_code_5339c6e449cc451aa21e46846febdaee-145"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-146" name="rest_code_5339c6e449cc451aa21e46846febdaee-146" href="#rest_code_5339c6e449cc451aa21e46846febdaee-146"></a>    <span class="n">rv</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-147" name="rest_code_5339c6e449cc451aa21e46846febdaee-147" href="#rest_code_5339c6e449cc451aa21e46846febdaee-147"></a>        <span class="n">byclodo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-148" name="rest_code_5339c6e449cc451aa21e46846febdaee-148" href="#rest_code_5339c6e449cc451aa21e46846febdaee-148"></a>            <span class="n">reachable</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">srepr</span><span class="p">,</span> <span class="p">[</span> <span class="n">heap</span><span class="p">,</span> <span class="n">heap</span><span class="o">.</span><span class="n">more</span><span class="p">,</span> <span class="n">heap</span><span class="o">.</span><span class="n">more</span><span class="o">.</span><span class="n">more</span> <span class="p">]),</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-149" name="rest_code_5339c6e449cc451aa21e46846febdaee-149" href="#rest_code_5339c6e449cc451aa21e46846febdaee-149"></a>            <span class="n">uncollectable</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">srepr</span><span class="p">,</span> <span class="p">[</span> <span class="n">heapu</span><span class="p">,</span> <span class="n">heapu</span><span class="o">.</span><span class="n">more</span><span class="p">,</span> <span class="n">heapu</span><span class="o">.</span><span class="n">more</span><span class="o">.</span><span class="n">more</span> <span class="p">]),</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-150" name="rest_code_5339c6e449cc451aa21e46846febdaee-150" href="#rest_code_5339c6e449cc451aa21e46846febdaee-150"></a>            <span class="n">statdump</span> <span class="o">=</span> <span class="n">statdump</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-151" name="rest_code_5339c6e449cc451aa21e46846febdaee-151" href="#rest_code_5339c6e449cc451aa21e46846febdaee-151"></a>            <span class="n">statdumpu</span> <span class="o">=</span> <span class="n">statdumpu</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-152" name="rest_code_5339c6e449cc451aa21e46846febdaee-152" href="#rest_code_5339c6e449cc451aa21e46846febdaee-152"></a>            <span class="n">refs</span> <span class="o">=</span> <span class="n">srepr</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-153" name="rest_code_5339c6e449cc451aa21e46846febdaee-153" href="#rest_code_5339c6e449cc451aa21e46846febdaee-153"></a>        <span class="p">),</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-154" name="rest_code_5339c6e449cc451aa21e46846febdaee-154" href="#rest_code_5339c6e449cc451aa21e46846febdaee-154"></a>        <span class="n">byrcs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-155" name="rest_code_5339c6e449cc451aa21e46846febdaee-155" href="#rest_code_5339c6e449cc451aa21e46846febdaee-155"></a>            <span class="n">reachable</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">srepr</span><span class="p">,</span> <span class="p">[</span> <span class="n">heapbr</span><span class="p">,</span> <span class="n">heapbr</span><span class="o">.</span><span class="n">more</span><span class="p">,</span> <span class="n">heapbr</span><span class="o">.</span><span class="n">more</span><span class="o">.</span><span class="n">more</span> <span class="p">]),</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-156" name="rest_code_5339c6e449cc451aa21e46846febdaee-156" href="#rest_code_5339c6e449cc451aa21e46846febdaee-156"></a>            <span class="n">statdump</span> <span class="o">=</span> <span class="n">statdumpbr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-157" name="rest_code_5339c6e449cc451aa21e46846febdaee-157" href="#rest_code_5339c6e449cc451aa21e46846febdaee-157"></a>        <span class="p">),</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-158" name="rest_code_5339c6e449cc451aa21e46846febdaee-158" href="#rest_code_5339c6e449cc451aa21e46846febdaee-158"></a>        <span class="n">memmap</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-159" name="rest_code_5339c6e449cc451aa21e46846febdaee-159" href="#rest_code_5339c6e449cc451aa21e46846febdaee-159"></a>            <span class="n">detail</span> <span class="o">=</span> <span class="n">memmap</span><span class="p">,</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-160" name="rest_code_5339c6e449cc451aa21e46846febdaee-160" href="#rest_code_5339c6e449cc451aa21e46846febdaee-160"></a>            <span class="n">lo</span> <span class="o">=</span> <span class="n">lomap</span><span class="p">,</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-161" name="rest_code_5339c6e449cc451aa21e46846febdaee-161" href="#rest_code_5339c6e449cc451aa21e46846febdaee-161"></a>            <span class="n">med</span> <span class="o">=</span> <span class="n">medmap</span><span class="p">,</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-162" name="rest_code_5339c6e449cc451aa21e46846febdaee-162" href="#rest_code_5339c6e449cc451aa21e46846febdaee-162"></a>            <span class="n">hi</span> <span class="o">=</span> <span class="n">himap</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-163" name="rest_code_5339c6e449cc451aa21e46846febdaee-163" href="#rest_code_5339c6e449cc451aa21e46846febdaee-163"></a>        <span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-164" name="rest_code_5339c6e449cc451aa21e46846febdaee-164" href="#rest_code_5339c6e449cc451aa21e46846febdaee-164"></a>    <span class="p">)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-165" name="rest_code_5339c6e449cc451aa21e46846febdaee-165" href="#rest_code_5339c6e449cc451aa21e46846febdaee-165"></a>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-166" name="rest_code_5339c6e449cc451aa21e46846febdaee-166" href="#rest_code_5339c6e449cc451aa21e46846febdaee-166"></a>    <span class="c1"># return a pickle dump, not by pure xmlrpc</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-167" name="rest_code_5339c6e449cc451aa21e46846febdaee-167" href="#rest_code_5339c6e449cc451aa21e46846febdaee-167"></a>    <span class="c1">#   (xmlrpc is picky, doesn't support big ints)</span>
<a id="rest_code_5339c6e449cc451aa21e46846febdaee-168" name="rest_code_5339c6e449cc451aa21e46846febdaee-168" href="#rest_code_5339c6e449cc451aa21e46846febdaee-168"></a>    <span class="k">return</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
<!-- ############################################################################ -->
    </div>    
</div>
        <!--End of body content-->

        <footer id="footer" class="bg-light"><span>Contents 춸 2025         <a href="mailto:admin@python.org.ar">Python Argentina</a> - Powered by         <a href="https://getnikola.com" rel="nofollow" target="_blanc">Nikola</a>         </span><span><a href="https://ac.python.org.ar/#donaciones" rel="nofollow" target="_blanc">Aporta a PyAr con tu donaci칩n</a><a></a></span>
            
        </footer>
</div>
</div>

            <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script src="../../assets/js/pyar.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="https://cdn.jsdelivr.net/gh/nextapps-de/flexsearch@0.8.0/dist/flexsearch.bundle.min.js"></script><script src="../../assets/js/flexsearch.js"></script>
</body>
</html>
